<!DOCTYPE html>
<html lang='en'><head>
  
  <title> YonKeenn &lt;/&gt;  </title>
  <link rel='canonical' href='https://yonkeenn.com/portfolio/project3-churnprediction/' />
  <meta charset='utf-8'>
  <meta name='viewport' content='width=device-width, initial-scale=1' />
  <meta name='description' content='Compare classic models for churn prediction' />
  <meta name='theme-color' content='#FD3519' />
  
    <link rel="shortcut icon" href="./images/logo1.png" type="image/x-icon" />
    <link rel="icon" href="./images/logo1.png" type="image/x-icon" />
  

  <meta name="generator" content="Hugo 0.80.0" />

  





<link rel="stylesheet" href="https://yonkeenn.com/sass/style.min.377978273bdc704005bbeb7927794716924ee1c96190be062582baa27b7c105d.css" integrity="sha256-N3l4JzvccEAFu&#43;t5J3lHFpJO4clhkL4GJYK6ont8EF0=" media="screen">
<link rel="stylesheet" href="https://yonkeenn.com/syntax.min.css" integrity="" media="screen">

  <meta property="og:title" content="Churn Prediction for Fintech Data" />
<meta property="og:description" content="Compare classic models for churn prediction" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://yonkeenn.com/portfolio/project3-churnprediction/" />
<meta property="article:published_time" content="2022-10-20T16:35:05-05:00" />
<meta property="article:modified_time" content="2022-10-20T16:35:05-05:00" />

  <meta itemprop="name" content="Churn Prediction for Fintech Data">
<meta itemprop="description" content="Compare classic models for churn prediction">
<meta itemprop="datePublished" content="2022-10-20T16:35:05-05:00" />
<meta itemprop="dateModified" content="2022-10-20T16:35:05-05:00" />
<meta itemprop="wordCount" content="8529">



<meta itemprop="keywords" content="" />

  
  
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/katex.min.css" integrity="sha384-Xi8rHCmBmhbuyyhbI88391ZKP2dmfnOl4rT9ZfRI7mLTdk1wblIUnrIq35nqwEvC" crossorigin="anonymous">


<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/katex.min.js" integrity="sha384-X/XCfMm41VSsqRNQgDerQczD69XqmjOOOwYQvr/uuC+j4OPoNhVgjdGFwhvN02Ja" crossorigin="anonymous"></script>


<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/contrib/auto-render.min.js" integrity="sha384-+XBljXPPiv+OzfbB3cVmLHf4hdUFHlWNZN5spNQ7rmHTXpd7WvJum6fIACpNNfIR" crossorigin="anonymous"
        onload="renderMathInElement(document.body);"></script>

<script>
    document.addEventListener("DOMContentLoaded", function() {
        renderMathInElement(document.body, {
            delimiters: [
                {left: "$$", right: "$$", display: true},
                {left: "$", right: "$", display: false}
            ]
        });
    });
</script>

  <script async src="https://unpkg.com/mermaid@8.2.3/dist/mermaid.min.js"></script>

  
  
</head>
<body>
  <div class="topmenu">
  <div>
    <a href="/" style="font-size: 1.5em; text-align: left">YonKeenn &lt;/> </a>
  </div>
  



<span>

<a href="/about/" style = "margin-left:20px; font-size: 1.5em; text-align: right" > About </a>

<a href="/portfolio/" style = "margin-left:20px; font-size: 1.5em; text-align: right" > Portfolio </a>

<a href="/research/" style = "margin-left:20px; font-size: 1.5em; text-align: right" > Research </a>

<a href="/post/" style = "margin-left:20px; font-size: 1.5em; text-align: right" > Post </a>

</span>




</div>

<div class="mobile-header">
  <p > YonKeenn &lt;/&gt;  </p>
  <div class="hamburger">
    <div class="bar"></div>
    <div class="bar"></div>
    <div class="bar"></div>
  </div>
</div>

<div class="overlay-menu">
  <header >
    <div class="intro">

      <div class="logo-container">
        <a href="/">
          <img src='https://yonkeenn.com/images/jhonvargas.jpeg' alt="Profile Customizing your theme" class="rounded-logo">
        </a>
      </div>

      <h3 style="text-align: center ;" >Hello, I'm Jhon Vargas - a Data Scientist & Technical Lead</h2>
      <h4 style="text-align: center ;" >Curious. Self Learning. Proactive.</h3>
      
      <div class="menu">
        



<span>

<a href="/about/" style = "margin-left:20px; font-size: 1.5em; text-align: right" > About </a>

<a href="/portfolio/" style = "margin-left:20px; font-size: 1.5em; text-align: right" > Portfolio </a>

<a href="/research/" style = "margin-left:20px; font-size: 1.5em; text-align: right" > Research </a>

<a href="/post/" style = "margin-left:20px; font-size: 1.5em; text-align: right" > Post </a>

</span>



      </div>
    </div>

    <div class="socials">
      <div style="background-color:#C5C6D0; padding: 0px 10px; margin:0px 10px 0px 0px; border-radius: 5px;">
        <a style="font-size: 1.5em; " href="/portfolio">Projects -></a>
      </div>       
      
  
    <a href="https://github.com/yonkeenn" class="social-link" target="_blank" rel="noopener" ><div class="icon">
  <svg width="35px" height="35px" viewBox="0 0 115 115" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img">
  
  <path d="M102.679 0H12.32C5.52 0 0 5.519 0 12.321v90.358C0 109.48 5.519 115 12.321 115h90.358c6.802 0 12.321-5.519 12.321-12.321V12.32C115 5.52 109.481 0 102.679 0zM71.182 98.494c-2.156.385-2.952-.95-2.952-2.053 0-1.386.051-8.471.051-14.195 0-4.005-1.335-6.546-2.9-7.881C74.878 73.313 84.89 72.003 84.89 55.6c0-4.671-1.669-7.007-4.39-10.01.436-1.105 1.9-5.648-.436-11.552-3.568-1.104-11.731 4.595-11.731 4.595-3.389-.95-7.06-1.438-10.679-1.438-3.62 0-7.29.488-10.679 1.438 0 0-8.163-5.699-11.73-4.595-2.337 5.878-.899 10.422-.437 11.551-2.72 3.004-4.004 5.34-4.004 10.011 0 16.326 9.574 17.712 19.072 18.765-1.232 1.104-2.336 3.003-2.72 5.724-2.44 1.104-8.677 3.004-12.4-3.568-2.335-4.056-6.545-4.39-6.545-4.39-4.159-.05-.282 2.619-.282 2.619 2.772 1.283 4.723 6.212 4.723 6.212 2.49 7.624 14.4 5.057 14.4 5.057 0 3.568.052 9.37.052 10.422 0 1.104-.77 2.438-2.952 2.053C27.21 92.821 15.35 76.701 15.35 57.86c0-23.564 18.02-41.456 41.585-41.456s42.663 17.892 42.663 41.456c.026 18.842-11.474 34.988-28.416 40.635zM46 82.81c-.488.103-.95-.102-1.001-.436-.051-.385.282-.719.77-.822.488-.05.95.154 1.001.488.077.334-.257.668-.77.77zm-2.439-.23c0 .333-.385.615-.898.615-.565.052-.95-.23-.95-.616 0-.333.385-.616.899-.616.487-.051.95.231.95.616zm-3.516-.283c-.103.334-.616.488-1.053.334-.488-.103-.821-.488-.719-.822.103-.334.617-.488 1.053-.385.513.154.847.54.719.873zm-3.158-1.386c-.23.282-.718.23-1.104-.154-.385-.334-.487-.822-.23-1.053.23-.282.718-.23 1.103.154.334.334.462.847.231 1.053zm-2.336-2.336c-.23.154-.667 0-.95-.385-.282-.385-.282-.822 0-1.001.283-.231.72-.052.95.333.283.385.283.847 0 1.053zm-1.668-2.49c-.231.23-.616.103-.899-.154-.282-.334-.333-.719-.102-.899.23-.23.616-.102.898.154.282.334.334.72.103.899zm-1.72-1.9c-.103.231-.436.283-.719.103-.334-.154-.488-.436-.385-.667.103-.154.385-.231.719-.103.334.18.488.462.385.667z"/>
  
  </svg>
</div>
</a>
  

  
    <a href="https://www.instagram.com/yonkeenn" class="social-link" target="_blank" rel="noopener" ><div class="icon">
  <svg width="35px" height="35px" viewBox="0 0 115 115" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img">
  
  <path d="M57.526 28.111c-16.254 0-29.364 13.11-29.364 29.363 0 16.254 13.11 29.364 29.364 29.364 16.253 0 29.363-13.11 29.363-29.364 0-16.253-13.11-29.363-29.363-29.363zm0 48.453c-10.504 0-19.09-8.56-19.09-19.09 0-10.528 8.56-19.09 19.09-19.09 10.528 0 19.09 8.562 19.09 19.09 0 10.53-8.587 19.09-19.09 19.09zM94.939 26.91a6.833 6.833 0 0 1-6.849 6.849 6.833 6.833 0 0 1-6.849-6.849 6.85 6.85 0 0 1 13.698 0zm19.448 6.951c-.435-9.174-2.53-17.301-9.251-23.997C98.44 3.17 90.313 1.074 81.139.614c-9.456-.537-37.797-.537-47.252 0-9.15.434-17.276 2.53-23.997 9.225S1.099 24.66.639 33.836c-.537 9.455-.537 37.796 0 47.252.434 9.174 2.53 17.3 9.251 23.996 6.721 6.696 14.822 8.792 23.997 9.252 9.455.536 37.796.536 47.252 0 9.174-.435 17.301-2.53 23.997-9.252 6.695-6.695 8.79-14.822 9.25-23.996.537-9.456.537-37.771 0-47.227zM102.17 91.233c-1.993 5.01-5.852 8.868-10.887 10.887-7.538 2.99-25.427 2.3-33.758 2.3-8.332 0-26.246.664-33.76-2.3-5.008-1.993-8.867-5.852-10.886-10.887-2.99-7.539-2.3-25.427-2.3-33.759 0-8.33-.664-26.245 2.3-33.758 1.993-5.01 5.852-8.868 10.887-10.887 7.539-2.99 25.427-2.3 33.759-2.3 8.33 0 26.245-.665 33.758 2.3 5.01 1.993 8.868 5.852 10.887 10.887 2.99 7.538 2.3 25.427 2.3 33.758 0 8.332.69 26.246-2.3 33.76z" />
  
  </svg>
</div>
</a>
  

  
    <a href="https://www.linkedin.com/in/yonkeenn" class="social-link" target="_blank" rel="noopener" ><div class="icon">
  <svg width="35px" height="35px" viewBox="0 0 115 115" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img">
  
  <path d="M106.786 0H8.189C3.67 0 0 3.722 0 8.291v98.418C0 111.278 3.67 115 8.189 115h98.597c4.518 0 8.214-3.722 8.214-8.291V8.29C115 3.722 111.304 0 106.786 0zm-72.03 98.571H17.713V43.69h17.07V98.57h-.025zm-8.522-62.377c-5.467 0-9.882-4.44-9.882-9.883 0-5.442 4.415-9.882 9.882-9.882 5.442 0 9.883 4.44 9.883 9.882a9.87 9.87 0 0 1-9.883 9.883zm72.414 62.377H81.604V71.875c0-6.366-.129-14.555-8.856-14.555-8.882 0-10.242 6.931-10.242 14.093V98.57H45.46V43.69h16.352v7.495h.23c2.285-4.312 7.855-8.856 16.147-8.856 17.25 0 20.458 11.372 20.458 26.158V98.57z"/>
  
  </svg>
</div>
</a>
  

    </div>
  </header>
</div>



 

<div class="content-wrapper">
  
    <div class="breadcrumb">
  





<span >
  <a href="https://yonkeenn.com/">HOME</a>
   / 
</span>


<span >
  <a href="https://yonkeenn.com/portfolio/">PORTFOLIO</a>
   / 
</span>


<span  class="active">
  <a href="https://yonkeenn.com/portfolio/project3-churnprediction/">Churn Prediction for Fintech Data</a>
  
</span>

</div>

  

<main id="content" class="portfolio">


<h1>Churn Prediction for Fintech Data</h1>
<div class="tags">
  
  <div class="designs portfolio-tags">
    <div class="icon">
  <svg width="18px" height="18px" viewBox="0 0 115 115" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img">
  
  <path d="M111.833 31.901l-10.355 10.355a2.698 2.698 0 0 1-3.819 0L72.727 17.324a2.698 2.698 0 0 1 0-3.819L83.082 3.15c4.2-4.2 11.028-4.2 15.251 0l13.5 13.5c4.223 4.2 4.223 11.029 0 15.251zm-48.001-9.5L4.846 81.384.085 108.676c-.652 3.684 2.56 6.873 6.244 6.244l27.291-4.784 58.985-58.985a2.698 2.698 0 0 0 0-3.818L67.673 22.4c-1.079-1.056-2.786-1.056-3.841 0zM27.87 76.33a3.132 3.132 0 0 1 0-4.448l34.591-34.59a3.132 3.132 0 0 1 4.448 0 3.132 3.132 0 0 1 0 4.447L32.317 76.33a3.132 3.132 0 0 1-4.447 0zm-8.109 18.89h10.782v8.154l-14.488 2.538-6.986-6.985 2.539-14.488h8.153V95.22z"/>
  
  </svg>
</div>

    
      <span>
          <a href="https://yonkeenn.com/designs/supervised-learning/">Supervised Learning</a>
        
      </span>
    
  </div>



  <div class="techs portfolio-tags">
    <div class="icon">
  <svg width="18px" height="18px" viewBox="0 0 115 115" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img">
  
  <path d="M112.125 86.25H103.5V34.5c0-6.325-5.175-11.5-11.5-11.5H23c-6.325 0-11.5 5.175-11.5 11.5v51.75H2.875A2.883 2.883 0 0 0 0 89.125v8.625C0 107.237 7.763 115 17.25 115h80.5c9.487 0 17.25-7.763 17.25-17.25v-8.625a2.883 2.883 0 0 0-2.875-2.875zm-92-51.75c0-1.558 1.317-2.875 2.875-2.875h69c1.558 0 2.875 1.317 2.875 2.875v51.75h-74.75V34.5zm86.25 63.25c0 4.756-3.869 8.625-8.625 8.625h-80.5c-4.756 0-8.625-3.869-8.625-8.625v-2.875H41.13c1.001 1.687 2.764 2.875 4.87 2.875h23c2.106 0 3.867-1.188 4.87-2.875h32.505v2.875zM49.892 70.015l2.032-2.032a2.875 2.875 0 0 0 0-4.066L45.506 57.5l6.416-6.418a2.875 2.875 0 0 0 0-4.067l-2.032-2.032a2.875 2.875 0 0 0-4.066 0L35.34 55.466a2.875 2.875 0 0 0 0 4.066l10.483 10.483a2.877 2.877 0 0 0 4.068 0zm13.185-2.03l2.033 2.032a2.875 2.875 0 0 0 4.066 0L79.66 59.534a2.875 2.875 0 0 0 0-4.066L69.176 44.985a2.875 2.875 0 0 0-4.066 0l-2.032 2.032a2.875 2.875 0 0 0 0 4.066l6.416 6.417-6.416 6.418a2.875 2.875 0 0 0 0 4.067z" />
  
  </svg>
</div>

    <span>
      
          <a href="https://yonkeenn.com/techs/pandas/">Pandas</a>
        
      <span>- </span>
          <a href="https://yonkeenn.com/techs/numpy/">Numpy</a>
        
      <span>- </span>
          <a href="https://yonkeenn.com/techs/sklearn/">Sklearn</a>
        
      <span>- </span>
          <a href="https://yonkeenn.com/techs/seaborn/">Seaborn</a>
        
      
    </span>
  </div>




<div class="portfolio-tags">
  <div class="icon">
  <svg width="18px" height="18px" viewBox="0 0 115 115" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img">
  
  <path d="M77.577 51.23a1.807 1.807 0 0 0-2.2.342l-27.562 27.79a1.807 1.807 0 0 1-2.2.342l-14.008-9.702a1.807 1.807 0 0 0-2.2.342l-1.952 1.968c-.287.22-.456.568-.455.936.001.37.172.716.46.934L45.637 86.77a1.807 1.807 0 0 0 2.2-.342l31.709-31.97c.287-.22.456-.567.455-.936a1.175 1.175 0 0 0-.46-.933l-1.963-1.36z"/><path d="M97.304 20H80.512c-.041.34-.063.683-.064 1.026a5.986 5.986 0 0 0 1.256 4.1c.054.003.103.02.157.025a4.881 4.881 0 0 1 1.865-.025c3.05.562 4.984 3.907 4.32 7.47-.666 3.563-3.678 5.996-6.728 5.433a4.932 4.932 0 0 1-2.437-1.258c-6.018-1.378-10.445-7.795-10.445-15.745 0-.347.023-.685.04-1.026H34.579c-.041.34-.063.683-.064 1.026a5.986 5.986 0 0 0 1.256 4.1c.054.003.103.02.157.025a4.881 4.881 0 0 1 1.865-.025c3.05.562 4.984 3.907 4.32 7.47-.666 3.563-3.678 5.996-6.728 5.433a4.932 4.932 0 0 1-2.437-1.258c-6.018-1.378-10.445-7.795-10.445-15.745 0-.22.019-.434.025-.652a9.788 9.788 0 0 0-5.697 4.471 9.683 9.683 0 0 0-2.65 4.764L1.158 92.871c-.965 4.689 2.6 8.503 7.948 8.503h6.334v2.673c-.077 5.41 4.263 9.861 9.705 9.953h72.16c5.438-.095 9.774-4.546 9.694-9.953V29.953c.08-5.407-4.256-9.858-9.695-9.953zM10.078 96.653c-2.378 0-3.964-1.697-3.535-3.782L16.637 43.84h80.787L87.331 92.871a5.254 5.254 0 0 1-5.091 3.782H10.078zm91.535 7.394c.036 2.403-1.891 4.382-4.308 4.424h-72.16c-2.42-.04-4.352-2.018-4.32-4.424v-2.673h60.443c5.348 0 10.484-3.814 11.449-8.503l8.897-43.215v54.391z"/><path d="M34.814 33c1.243 0 2.251-1.057 2.251-2.36 0-1.305-1.008-2.362-2.25-2.362-2.04 0-4.313-3.194-4.313-7.778s2.272-7.778 4.312-7.778c1.227 0 2.536 1.163 3.386 3.084H43C41.716 11.19 38.578 8 34.814 8 29.871 8 26 13.49 26 20.5c0 7.009 3.871 12.5 8.814 12.5z"/>
  
  </svg>
</div>

  <span>2022</span>
</div>
</div>



<style>
r { color: Red }
o { color: Orange }
g { color: Green }
b { color: blue}
</style>
<p><b> <strong>Brief</strong> </b> : The main idea of the project is to predict churn and which parameters is more relevant during analysis using classic supervised techniques like LR, DT, SVM, RF, KNN with the help of GridSearchCV.</p>
<h2 id="objective">Objective</h2>
<p>Predict user churn of fintech app using clasical supervised models.</p>
<h2 id="project-overview">Project Overview</h2>
<ul>
<li>Get dataset from fintech app, anderstand the key features.</li>
<li>Explore and Analyze the behaviour of data related to null values, duplicated indexes, balancing data, outliers, categorical and numerical analysis, get some insights with compared analysis between churn and key features.</li>
<li>As result of exploration phase, pre-process the dataset for being accurate to train, test and later use it in the prediction.</li>
<li>Model and evaluate 5 models with GridSearchCV for hyperparameter tunning and compare metrics to find the best model.</li>
<li>Save the model with pickle package in order to use later for prediction test.</li>
<li>Create an app where we can use the model.</li>
<li><strong>Note:</strong> For more details <a href='https://github.com/yonkeenn/projectChurnRate' target="_blank" > HERE	</a></li>
</ul>
<p>In order to have a big picture about the project, here a diagram of each phase:</p>
<div class="mermaid">
    
graph LR;
    A[Data set <br> for trainning/testing] --> B[Exploration]
    B --> C{Pre-Processing}
    C -->|Training| D[Fitting]
    D -->|Feature Selection, Tunning| F[Model] 
    F --> E[Evaluation]
    F --> H[Prediction]
    C -->|Testing| F
    G[Data set <br> for  predicting] -->|Pre-Processing| F
    

</div>
<hr>
<h2 id="index-a-idindicea">Index <a id="indice"></a></h2>
<ul>
<li><a href="#section1">1. Dataset</a></li>
<li><a href="#section2">2. Exploration and Analysis</a></li>
<li><a href="#section3">3. Pre-Processing</a></li>
<li><a href="#section4">4. Model and Evaluation</a></li>
<li><a href="#section5">5. Prediction</a></li>
<li><a href="#section6">6. Conclusions and Lessons learned</a></li>
</ul>
<hr>
<h2 id="1-dataset-a-idsection1a">1. Dataset <a id="section1"></a></h2>
<h3 id="11-dataset-understanding">1.1. Dataset Understanding</h3>
<p>The bussines challenge: A subscription model on a fintech have users who use the app which it can bring some information about customer behavior. Normaly companies try to minimize the churn which it means cancel subscription. The object is to predict when customer is trying to churn and which feature is the most relevant.</p>
<p>Here some of the fearures:</p>
<ul>
<li>userid - userid</li>
<li>churn - Active = No	Suspended &lt; 30 = No Else Churn = Yes</li>
<li>age - age of the customer</li>
<li>zodiac_sign - zodiac sign of the customer</li>
<li>housing - rent_or_own - Does the customer rents or owns a house</li>
<li>withdrawn_application - has the customer withdrawn the loan applicaiton</li>
<li>used_ios- Has the user used an iphone</li>
<li>used_android - Has the user used a android based phone</li>
<li>has_used_web - Has the user used MoneyLion Web app</li>
<li>has_used_mobile - as the user used MoneyLion app</li>
<li>has_reffered- Has the user referred</li>
<li>credit_score - Customer’s credit score</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="c1"># Loading the data</span>

<span class="n">dfChurnBank</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;../projectChurnRate/Data/churn_data.csv&#39;</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="s2">&#34;Size of the dataset:  </span><span class="si">%d</span><span class="s2">&#34;</span> <span class="o">%</span> <span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="k">print</span><span class="p">(</span><span class="s2">&#34;Number of variables: </span><span class="si">%d</span><span class="s2">&#34;</span> <span class="o">%</span> <span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

<span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">is_unique</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;Indexes are unique.&#39;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;There are duplicated indexes.&#39;</span><span class="p">)</span>
    
<span class="n">dfChurnBank</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>

<span class="c1"># Output:</span>
<span class="n">Size</span> <span class="n">of</span> <span class="n">the</span> <span class="n">dataset</span><span class="p">:</span>  <span class="mi">21600</span>
<span class="n">Number</span> <span class="n">of</span> <span class="n">variables</span><span class="p">:</span> <span class="mi">30</span>
<span class="n">There</span> <span class="n">are</span> <span class="n">duplicated</span> <span class="n">indexes</span><span class="o">.</span>

<span class="n">user</span>  <span class="n">churn</span>	<span class="n">age</span>	<span class="n">housing</span>	<span class="n">credit_score</span>	<span class="n">deposits</span>	<span class="n">withdrawal</span>	<span class="n">purchases_partners</span>	<span class="n">purchases</span>	<span class="n">cc_taken</span>	<span class="n">cc_recommended</span>	<span class="o">...</span>	<span class="n">waiting_4_loan</span>	<span class="n">cancelled_loan</span>	<span class="n">received_loan</span>	<span class="n">rejected_loan</span>	<span class="n">zodiac_sign</span>	<span class="n">left_for_two_month_plus</span>	<span class="n">left_for_one_month</span>	<span class="n">rewards_earned</span>	<span class="n">reward_rate</span>	<span class="n">is_referred</span>
																					
<span class="mi">55409</span>	<span class="mi">0</span>	<span class="mf">37.0</span>	<span class="n">na</span>	<span class="n">NaN</span>	<span class="mi">0</span>	<span class="mi">0</span>	<span class="mi">0</span>	<span class="mi">0</span>	<span class="mi">0</span>	<span class="mi">0</span>	<span class="o">...</span>	<span class="mi">0</span>	<span class="mi">0</span>	<span class="mi">0</span>	<span class="mi">0</span>	<span class="n">Leo</span>	<span class="mi">1</span>	<span class="mi">0</span>	<span class="n">NaN</span>	<span class="mf">0.00</span>	<span class="mi">0</span>
<span class="mi">23547</span>	<span class="mi">0</span>	<span class="mf">28.0</span>	<span class="n">R</span>	<span class="mf">486.0</span>	<span class="mi">0</span>	<span class="mi">0</span>	<span class="mi">1</span>	<span class="mi">0</span>	<span class="mi">0</span>	<span class="mi">96</span>	<span class="o">...</span>	<span class="mi">0</span>	<span class="mi">0</span>	<span class="mi">0</span>	<span class="mi">0</span>	<span class="n">Leo</span>	<span class="mi">0</span>	<span class="mi">0</span>	<span class="mf">44.0</span>	<span class="mf">1.47</span>	<span class="mi">1</span>
<span class="mi">58313</span>	<span class="mi">0</span>	<span class="mf">35.0</span>	<span class="n">R</span>	<span class="mf">561.0</span>	<span class="mi">47</span>	<span class="mi">2</span>	<span class="mi">86</span>	<span class="mi">47</span>	<span class="mi">0</span>	<span class="mi">285</span>	<span class="o">...</span>	<span class="mi">0</span>	<span class="mi">0</span>	<span class="mi">0</span>	<span class="mi">0</span>	<span class="n">Capricorn</span>	<span class="mi">1</span>	<span class="mi">0</span>	<span class="mf">65.0</span>	<span class="mf">2.17</span>	<span class="mi">0</span>
<span class="mi">8095</span>	<span class="mi">0</span>	<span class="mf">26.0</span>	<span class="n">R</span>	<span class="mf">567.0</span>	<span class="mi">26</span>	<span class="mi">3</span>	<span class="mi">38</span>	<span class="mi">25</span>	<span class="mi">0</span>	<span class="mi">74</span>	<span class="o">...</span>	<span class="mi">0</span>	<span class="mi">0</span>	<span class="mi">0</span>	<span class="mi">0</span>	<span class="n">Capricorn</span>	<span class="mi">0</span>	<span class="mi">0</span>	<span class="mf">33.0</span>	<span class="mf">1.10</span>	<span class="mi">1</span>
<span class="mi">61353</span>	<span class="mi">1</span>	<span class="mf">27.0</span>	<span class="n">na</span>	<span class="n">NaN</span>	<span class="mi">0</span>	<span class="mi">0</span>	<span class="mi">2</span>	<span class="mi">0</span>	<span class="mi">0</span>	<span class="mi">0</span>	<span class="o">...</span>	<span class="mi">0</span>	<span class="mi">0</span>	<span class="mi">0</span>	<span class="mi">0</span>	<span class="n">Aries</span>	<span class="mi">1</span>	<span class="mi">0</span>	<span class="mf">1.0</span>	<span class="mf">0.03</span>	<span class="mi">0</span>
<span class="mi">5</span> <span class="n">rows</span> <span class="err">×</span> <span class="mi">30</span> <span class="n">columns</span>

</code></pre></td></tr></table>
</div>
</div><div style="text-align: right">
  <a href="#indice">⬆</a>
</div>
<hr>
<h2 id="2-exploration-and-analysis-a-idsection2a">2. Exploration and Analysis <a id="section2"></a></h2>
<p>For exploration, we will focus on check how is the behavior of data related to the following topics:</p>
<ol>
<li>Checking Null and na values</li>
<li>Check if index is duplicated</li>
<li>Verify balance data on dataset</li>
<li>Dataframe data type analysis -&gt; Categorical and numerical for separated</li>
<li>Check outliers</li>
<li>Analysis of Churn over features</li>
<li>Conclusions after exploration and analysis</li>
</ol>
<h3 id="21-checking-null-and-na-values">2.1. Checking Null and na values</h3>
<p>As we can see there are many null values on credit_score and rewards_earned columns. If we remove null values as rows, we will lost many data and dataset size will reduce a lot, so the best option it is to remove them. On the other hand, age column only has 4 null values, so we can drop null values as rows(axis=0).</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="n">null_finder</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>

<span class="k">print</span><span class="p">(</span><span class="s2">&#34; ***** Number of Null Values by row: ***** &#34;</span><span class="p">)</span>
<span class="n">null_finder</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">null_finder</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>

<span class="c1"># Output:</span>
 <span class="o">*****</span> <span class="n">Number</span> <span class="n">of</span> <span class="n">Null</span> <span class="n">Values</span> <span class="n">by</span> <span class="n">row</span><span class="p">:</span> <span class="o">*****</span> 
<span class="n">age</span>                  <span class="mf">4.0</span>
<span class="n">credit_score</span>      <span class="mf">6436.0</span>
<span class="n">rewards_earned</span>    <span class="mf">2569.0</span>
<span class="n">dtype</span><span class="p">:</span> <span class="n">float64</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="22-check-if-index-is-duplicated">2.2. Check if index is duplicated</h3>
<p>There are duplicated indexes.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">is_unique</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;Indexes are unique.&#39;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;There are duplicated indexes.&#39;</span><span class="p">)</span>

<span class="c1"># Output:</span>
<span class="n">There</span> <span class="n">are</span> <span class="n">duplicated</span> <span class="n">indexes</span><span class="o">.</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="23-verify-balance-data-on-dataset">2.3. Verify balance data on dataset</h3>
<p>For continue EDA, we have to remove null/nas and duplicated indexes in order to have a good explorarion.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="n">sns</span><span class="o">.</span><span class="n">countplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;churn&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">df</span><span class="p">)</span>

<span class="n">class_ratio_0</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;churn&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;churn&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">class_ratio_1</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;churn&#39;</span><span class="p">])[</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;churn&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

<span class="k">print</span><span class="p">(</span><span class="s1">&#39;Class Ratio of {:} is {:.2f}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">Counter</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;churn&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="mi">0</span><span class="p">],</span> <span class="n">class_ratio_0</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="s1">&#39;Class Ratio of {:} is {:.2f}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">Counter</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;churn&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="mi">1</span><span class="p">],</span> <span class="n">class_ratio_1</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="s1">&#39;Class Ratio of 1 over 0 is {:.2f}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">class_ratio_1</span><span class="o">/</span><span class="n">class_ratio_0</span><span class="p">))</span>

<span class="c1"># Output:</span>
<span class="n">Class</span> <span class="n">Ratio</span> <span class="n">of</span> <span class="mi">0</span> <span class="ow">is</span> <span class="mf">0.56</span>
<span class="n">Class</span> <span class="n">Ratio</span> <span class="n">of</span> <span class="mi">1</span> <span class="ow">is</span> <span class="mf">0.44</span>
<span class="n">Class</span> <span class="n">Ratio</span> <span class="n">of</span> <span class="mi">1</span> <span class="n">over</span> <span class="mi">0</span> <span class="ow">is</span> <span class="mf">0.80</span>
</code></pre></td></tr></table>
</div>
</div><p><br>
As we can see, the ratio of the class variable is almost balanced. So in this way, we don&rsquo;t need to use any technique for balance them.</p>
<ul>
<li>Class 1 -&gt; churn</li>
<li>Class 0 -&gt; no churn</li>
</ul>
<p><img src = "./images/balanced.png" style="height: 70%; width:70%; display: block; margin-left: auto; margin-right: auto;" /></p>
<h3 id="24-dataframe-data-type-analysis">2.4. Dataframe data type analysis</h3>
<p>For this kind of analysis, we have to separate into categorical and numerical variables. Hence, we define 2 list: cat_features and num_features.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="c1"># Separation of data types for EDA</span>

<span class="n">cat_features</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">exclude</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">number</span><span class="p">)</span><span class="o">.</span><span class="n">columns</span>
<span class="n">num_features</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">include</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">number</span><span class="p">)</span><span class="o">.</span><span class="n">columns</span>
<span class="k">print</span><span class="p">(</span> <span class="s2">&#34;Quantity of Categorical features: &#34;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">cat_features</span><span class="p">),</span><span class="s2">&#34;</span><span class="se">\n</span><span class="s2">Categorical features: &#34;</span><span class="p">,</span> <span class="n">cat_features</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span> <span class="s2">&#34;</span><span class="se">\n</span><span class="s2">Quantity of Numerical features: &#34;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">num_features</span><span class="p">),</span><span class="s2">&#34;</span><span class="se">\n</span><span class="s2">Numerical features: &#34;</span><span class="p">,</span> <span class="n">num_features</span><span class="p">)</span>

<span class="c1"># Output:</span>
<span class="n">Quantity</span> <span class="n">of</span> <span class="n">Categorical</span> <span class="n">features</span><span class="p">:</span>  <span class="mi">3</span> 
<span class="n">Categorical</span> <span class="n">features</span><span class="p">:</span>  <span class="n">Index</span><span class="p">([</span><span class="s1">&#39;housing&#39;</span><span class="p">,</span> <span class="s1">&#39;payment_type&#39;</span><span class="p">,</span> <span class="s1">&#39;zodiac_sign&#39;</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;object&#39;</span><span class="p">)</span>

<span class="n">Quantity</span> <span class="n">of</span> <span class="n">Numerical</span> <span class="n">features</span><span class="p">:</span>  <span class="mi">25</span> 
<span class="n">Numerical</span> <span class="n">features</span><span class="p">:</span>  <span class="n">Index</span><span class="p">([</span><span class="s1">&#39;churn&#39;</span><span class="p">,</span> <span class="s1">&#39;age&#39;</span><span class="p">,</span> <span class="s1">&#39;deposits&#39;</span><span class="p">,</span> <span class="s1">&#39;withdrawal&#39;</span><span class="p">,</span> <span class="s1">&#39;purchases_partners&#39;</span><span class="p">,</span>
       <span class="s1">&#39;purchases&#39;</span><span class="p">,</span> <span class="s1">&#39;cc_taken&#39;</span><span class="p">,</span> <span class="s1">&#39;cc_recommended&#39;</span><span class="p">,</span> <span class="s1">&#39;cc_disliked&#39;</span><span class="p">,</span> <span class="s1">&#39;cc_liked&#39;</span><span class="p">,</span>
       <span class="s1">&#39;cc_application_begin&#39;</span><span class="p">,</span> <span class="s1">&#39;app_downloaded&#39;</span><span class="p">,</span> <span class="s1">&#39;web_user&#39;</span><span class="p">,</span> <span class="s1">&#39;app_web_user&#39;</span><span class="p">,</span>
       <span class="s1">&#39;ios_user&#39;</span><span class="p">,</span> <span class="s1">&#39;android_user&#39;</span><span class="p">,</span> <span class="s1">&#39;registered_phones&#39;</span><span class="p">,</span> <span class="s1">&#39;waiting_4_loan&#39;</span><span class="p">,</span>
       <span class="s1">&#39;cancelled_loan&#39;</span><span class="p">,</span> <span class="s1">&#39;received_loan&#39;</span><span class="p">,</span> <span class="s1">&#39;rejected_loan&#39;</span><span class="p">,</span>
       <span class="s1">&#39;left_for_two_month_plus&#39;</span><span class="p">,</span> <span class="s1">&#39;left_for_one_month&#39;</span><span class="p">,</span> <span class="s1">&#39;reward_rate&#39;</span><span class="p">,</span>
       <span class="s1">&#39;is_referred&#39;</span><span class="p">],</span>
      <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;object&#39;</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="241-categorical-analysis">2.4.1. Categorical analysis:</h4>
<p>We can see that those values cannot be binarized because they has more than 2 values. Hence, we need to use one-hot encoding technique. On the other hand, for removing &lsquo;na&rsquo; values, we have to check the amount of those values.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python">
<span class="k">print</span><span class="p">(</span><span class="s2">&#34;Different quantity values: &#34;</span> <span class="p">,</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">col</span><span class="p">:</span> <span class="p">(</span><span class="n">col</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">())),</span> <span class="n">df</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">exclude</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">number</span><span class="p">)</span><span class="o">.</span><span class="n">columns</span><span class="p">)))</span>

<span class="k">print</span><span class="p">(</span><span class="s2">&#34;</span><span class="se">\n</span><span class="s2">housing feature values: &#34;</span><span class="p">,</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;housing&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span> <span class="p">,</span>
      <span class="s2">&#34;</span><span class="se">\n</span><span class="s2">payment_type feature value: &#34;</span><span class="p">,</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;payment_type&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span> <span class="p">,</span>
      <span class="s2">&#34;</span><span class="se">\n</span><span class="s2">zodiac_sign feature values: &#34;</span><span class="p">,</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;zodiac_sign&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span>
<span class="c1"># Output:</span>
<span class="n">Different</span> <span class="n">quantity</span> <span class="n">values</span><span class="p">:</span>  <span class="p">[(</span><span class="s1">&#39;housing&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;payment_type&#39;</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;zodiac_sign&#39;</span><span class="p">,</span> <span class="mi">13</span><span class="p">)]</span>

<span class="n">housing</span> <span class="n">feature</span> <span class="n">values</span><span class="p">:</span>  <span class="p">[</span><span class="s1">&#39;na&#39;</span> <span class="s1">&#39;R&#39;</span> <span class="s1">&#39;O&#39;</span><span class="p">]</span> 
<span class="n">payment_type</span> <span class="n">feature</span> <span class="n">value</span><span class="p">:</span>  <span class="p">[</span><span class="s1">&#39;Bi-Weekly&#39;</span> <span class="s1">&#39;Weekly&#39;</span> <span class="s1">&#39;na&#39;</span> <span class="s1">&#39;Monthly&#39;</span> <span class="s1">&#39;Semi-Monthly&#39;</span><span class="p">]</span> 
<span class="n">zodiac_sign</span> <span class="n">feature</span> <span class="n">values</span><span class="p">:</span>  <span class="p">[</span><span class="s1">&#39;Aquarius&#39;</span> <span class="s1">&#39;Scorpio&#39;</span> <span class="s1">&#39;Capricorn&#39;</span> <span class="s1">&#39;Pisces&#39;</span> <span class="s1">&#39;Gemini&#39;</span> <span class="s1">&#39;Cancer&#39;</span> <span class="s1">&#39;Virgo&#39;</span>
 <span class="s1">&#39;Libra&#39;</span> <span class="s1">&#39;na&#39;</span> <span class="s1">&#39;Leo&#39;</span> <span class="s1">&#39;Aries&#39;</span> <span class="s1">&#39;Taurus&#39;</span> <span class="s1">&#39;Sagittarius&#39;</span><span class="p">]</span>
</code></pre></td></tr></table>
</div>
</div><p>As we can see, there are a lot of &lsquo;na&rsquo; values. We can remove them one hot technique(dummy) later during pre-processing.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="c1"># Counting &#34;na&#34; values:</span>

<span class="k">print</span><span class="p">(</span><span class="s2">&#34;na values from housing: &#34;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;housing&#39;</span><span class="p">]</span> <span class="o">==</span>  <span class="s1">&#39;na&#39;</span><span class="p">])</span> <span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s2">&#34;na values from payment_type: &#34;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;payment_type&#39;</span><span class="p">]</span> <span class="o">==</span>  <span class="s1">&#39;na&#39;</span><span class="p">])</span> <span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s2">&#34;na values from zodiac:sign: &#34;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;zodiac_sign&#39;</span><span class="p">]</span> <span class="o">==</span>  <span class="s1">&#39;na&#39;</span><span class="p">])</span> <span class="p">)</span>
<span class="c1"># Output:</span>
<span class="n">na</span> <span class="n">values</span> <span class="kn">from</span> <span class="nn">housing</span><span class="p">:</span>  <span class="mi">10373</span>
<span class="n">na</span> <span class="n">values</span> <span class="kn">from</span> <span class="nn">payment_type</span><span class="p">:</span>  <span class="mi">2883</span>
<span class="n">na</span> <span class="n">values</span> <span class="kn">from</span> <span class="nn">zodiac</span><span class="p">:</span><span class="n">sign</span><span class="p">:</span>  <span class="mi">1570</span>


<span class="c1">####</span>
<span class="c1"># Analysis each categorical feature by churn quantity in order to know which one is more relevant than other.</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">cat_features</span><span class="p">),</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">28</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>

<span class="k">for</span> <span class="n">col</span><span class="p">,</span> <span class="n">ax</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">axs</span><span class="o">.</span><span class="n">flatten</span><span class="p">()):</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">countplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">cat_features</span><span class="p">[</span><span class="n">col</span><span class="p">],</span> <span class="n">hue</span><span class="o">=</span><span class="s1">&#39;churn&#39;</span><span class="p">,</span> <span class="n">dodge</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">df</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">axs</span><span class="p">[</span><span class="n">col</span><span class="p">])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">cat_features</span><span class="p">[</span><span class="n">col</span><span class="p">])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">get_xticklabels</span><span class="p">(),</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p><br>
<img src = "./images/categorical.png" style="height: 100%; width:100%; display: block; margin-left: auto; margin-right: auto;" /></p>
<p>As we can see, this values should be traslate to numbers with one hot encoding technique in order to keep the size of dataset. Categorical values should be considered becuase it affect on churn behavior. Here some insights:</p>
<ul>
<li>The people who has the Bi-weekly payment_type churn more than others</li>
<li>The people who Rent(R) churn more than people who Own(O) his home.</li>
</ul>
<h4 id="241-numerical-analysis">2.4.1. Numerical analysis:</h4>
<p>From correlation matrix, we can get some insights like the following:</p>
<ul>
<li>correlation 0.91 between app_web_user and web_user. It means they are positively depended so we can ommit one of them.</li>
<li>correlation 0.88 between reward_rate and cc_recommended. It means they are positively depended so we can ommit one of them.</li>
<li>correlation -0.84 between android_user and ios_user. It means they are negatively depended so we can ommit one of them.</li>
<li>correlation 1 between purchases and deposit. It means they are positively depended so we can ommit one of them.</li>
</ul>
<p><img src = "./images/correlation.png" style="height: 70%; width:70%; display: block; margin-left: auto; margin-right: auto;" /></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="c1"># Quantity of numerical values:</span>

<span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">col</span><span class="p">:</span> <span class="p">(</span><span class="n">col</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">())),</span> <span class="n">df</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">include</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">number</span><span class="p">)</span><span class="o">.</span><span class="n">columns</span><span class="p">))</span>

<span class="c1"># Output:</span>
<span class="p">[(</span><span class="s1">&#39;churn&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
 <span class="p">(</span><span class="s1">&#39;age&#39;</span><span class="p">,</span> <span class="mi">69</span><span class="p">),</span>
 <span class="p">(</span><span class="s1">&#39;deposits&#39;</span><span class="p">,</span> <span class="mi">66</span><span class="p">),</span>
 <span class="p">(</span><span class="s1">&#39;withdrawal&#39;</span><span class="p">,</span> <span class="mi">20</span><span class="p">),</span>
 <span class="p">(</span><span class="s1">&#39;purchases_partners&#39;</span><span class="p">,</span> <span class="mi">281</span><span class="p">),</span>
 <span class="p">(</span><span class="s1">&#39;purchases&#39;</span><span class="p">,</span> <span class="mi">64</span><span class="p">),</span>
 <span class="p">(</span><span class="s1">&#39;cc_taken&#39;</span><span class="p">,</span> <span class="mi">11</span><span class="p">),</span>
 <span class="p">(</span><span class="s1">&#39;cc_recommended&#39;</span><span class="p">,</span> <span class="mi">324</span><span class="p">),</span>
 <span class="p">(</span><span class="s1">&#39;cc_disliked&#39;</span><span class="p">,</span> <span class="mi">20</span><span class="p">),</span>
 <span class="p">(</span><span class="s1">&#39;cc_liked&#39;</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span>
 <span class="p">(</span><span class="s1">&#39;cc_application_begin&#39;</span><span class="p">,</span> <span class="mi">123</span><span class="p">),</span>
 <span class="p">(</span><span class="s1">&#39;app_downloaded&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
 <span class="p">(</span><span class="s1">&#39;web_user&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
 <span class="p">(</span><span class="s1">&#39;app_web_user&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
 <span class="p">(</span><span class="s1">&#39;ios_user&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
 <span class="p">(</span><span class="s1">&#39;android_user&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
 <span class="p">(</span><span class="s1">&#39;registered_phones&#39;</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span>
 <span class="p">(</span><span class="s1">&#39;waiting_4_loan&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
 <span class="p">(</span><span class="s1">&#39;cancelled_loan&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
 <span class="p">(</span><span class="s1">&#39;received_loan&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
 <span class="p">(</span><span class="s1">&#39;rejected_loan&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
 <span class="p">(</span><span class="s1">&#39;left_for_two_month_plus&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
 <span class="p">(</span><span class="s1">&#39;left_for_one_month&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
 <span class="p">(</span><span class="s1">&#39;reward_rate&#39;</span><span class="p">,</span> <span class="mi">186</span><span class="p">),</span>
 <span class="p">(</span><span class="s1">&#39;is_referred&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)]</span>
</code></pre></td></tr></table>
</div>
</div><p>As we can see there are binary fearures and other are longer than 2 values.</p>
<p>First, we will explore features which has more than 2 different values because there are many like (&lsquo;registered_phones&rsquo;, 5), (&lsquo;cc_disliked&rsquo;, 20),  (&lsquo;cc_taken&rsquo;, 11) and (&lsquo;withdrawal&rsquo;, 20) which have specific values.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="n">num_features_new</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">col</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">())</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">,</span> <span class="n">num_features</span><span class="p">))</span>
<span class="n">num_features_bin</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">col</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">())</span> <span class="o">==</span> <span class="mi">2</span><span class="p">,</span> <span class="n">num_features</span><span class="p">))</span>

<span class="k">print</span><span class="p">(</span><span class="s2">&#34;Quantity of features greater than 2:&#34;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">num_features_new</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="n">num_features_new</span><span class="p">)</span>
<span class="k">print</span><span class="p">()</span>
<span class="k">print</span><span class="p">(</span><span class="s2">&#34;Quantity of features equal to 2(binary):&#34;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">num_features_bin</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="n">num_features_bin</span><span class="p">)</span>

<span class="c1"># Output:</span>
<span class="n">Quantity</span> <span class="n">of</span> <span class="n">features</span> <span class="n">greater</span> <span class="n">than</span> <span class="mi">2</span><span class="p">:</span> <span class="mi">12</span>
<span class="p">[</span><span class="s1">&#39;age&#39;</span><span class="p">,</span> <span class="s1">&#39;deposits&#39;</span><span class="p">,</span> <span class="s1">&#39;withdrawal&#39;</span><span class="p">,</span> <span class="s1">&#39;purchases_partners&#39;</span><span class="p">,</span> <span class="s1">&#39;purchases&#39;</span><span class="p">,</span> <span class="s1">&#39;cc_taken&#39;</span><span class="p">,</span> <span class="s1">&#39;cc_recommended&#39;</span><span class="p">,</span> <span class="s1">&#39;cc_disliked&#39;</span><span class="p">,</span> <span class="s1">&#39;cc_liked&#39;</span><span class="p">,</span> <span class="s1">&#39;cc_application_begin&#39;</span><span class="p">,</span> <span class="s1">&#39;registered_phones&#39;</span><span class="p">,</span> <span class="s1">&#39;reward_rate&#39;</span><span class="p">]</span>

<span class="n">Quantity</span> <span class="n">of</span> <span class="n">features</span> <span class="n">equal</span> <span class="n">to</span> <span class="mi">2</span><span class="p">(</span><span class="n">binary</span><span class="p">):</span> <span class="mi">13</span>
<span class="p">[</span><span class="s1">&#39;churn&#39;</span><span class="p">,</span> <span class="s1">&#39;app_downloaded&#39;</span><span class="p">,</span> <span class="s1">&#39;web_user&#39;</span><span class="p">,</span> <span class="s1">&#39;app_web_user&#39;</span><span class="p">,</span> <span class="s1">&#39;ios_user&#39;</span><span class="p">,</span> <span class="s1">&#39;android_user&#39;</span><span class="p">,</span> <span class="s1">&#39;waiting_4_loan&#39;</span><span class="p">,</span> <span class="s1">&#39;cancelled_loan&#39;</span><span class="p">,</span> <span class="s1">&#39;received_loan&#39;</span><span class="p">,</span> <span class="s1">&#39;rejected_loan&#39;</span><span class="p">,</span> <span class="s1">&#39;left_for_two_month_plus&#39;</span><span class="p">,</span> <span class="s1">&#39;left_for_one_month&#39;</span><span class="p">,</span> <span class="s1">&#39;is_referred&#39;</span><span class="p">]</span>

</code></pre></td></tr></table>
</div>
</div><p>In the next pictures, We can see that there are some features like &lsquo;deposits&rsquo;, &lsquo;withdrawal&rsquo;, &lsquo;purchases&rsquo;, &lsquo;cc_taken&rsquo;, &lsquo;cc_disliked&rsquo;, &lsquo;cc_liked&rsquo;, &lsquo;registered_phones&rsquo; which has huge values as 0(zero) than other values. Later during removing outliers, all the values will be 0, so those features are not useful. We have to remove them.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="c1"># Exploring the distribution about num_features_new values: &#39;age&#39;, &#39;credit_score&#39;, &#39;deposits&#39; , &#39;purchases_partners&#39;, &#39;purchases&#39;, &#39;cc_recommended&#39;, &#39;cc_application_begin&#39;, &#39;rewards_earned&#39;, &#39;reward_rate&#39;</span>

<span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">num_features_new</span><span class="p">:</span>
    <span class="c1">#plt.figure(figsize=(5,2))</span>
    <span class="c1">#sns.countplot(x=col, data=df)</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">displot</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">],</span> <span class="n">kde</span> <span class="o">=</span> <span class="bp">True</span><span class="p">,</span> <span class="n">height</span> <span class="o">=</span> <span class="mi">5</span> <span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">9</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="n">labelpad</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Counts&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></td></tr></table>
</div>
</div><p><img src = "./images/numerical1.png" style="height: 70%; width:70%; display: block; margin-left: auto; margin-right: auto;" />
<img src = "./images/numerical2.png" style="height: 70%; width:70%; display: block; margin-left: auto; margin-right: auto;" /></p>
<p>For continue the exploration, we will ommit &lsquo;churn&rsquo;, &lsquo;app_downloaded&rsquo;, &lsquo;web_user&rsquo;, &lsquo;app_web_user&rsquo;, &lsquo;ios_user&rsquo;, &lsquo;android_user&rsquo; because they already have been analyzed. So we focus in the rest. We can see that there is 2 main insights:</p>
<ul>
<li>&lsquo;waiting_4_loan&rsquo;, &lsquo;cancelled_loan&rsquo;, &lsquo;received_loan&rsquo;, &lsquo;left_for_one_month&rsquo;,&lsquo;rejected_loan&rsquo; have almost the same distribution regarded churn. So we will only use one of them.</li>
<li>The others seems have different behaviors.</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="n">num_features_binary</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;waiting_4_loan&#39;</span><span class="p">,</span> <span class="s1">&#39;cancelled_loan&#39;</span><span class="p">,</span> <span class="s1">&#39;received_loan&#39;</span><span class="p">,</span> <span class="s1">&#39;rejected_loan&#39;</span><span class="p">,</span> <span class="s1">&#39;left_for_two_month_plus&#39;</span><span class="p">,</span> <span class="s1">&#39;left_for_one_month&#39;</span><span class="p">,</span> <span class="s1">&#39;is_referred&#39;</span><span class="p">]</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">num_features_binary</span><span class="p">),</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">28</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>

<span class="k">for</span> <span class="n">col</span><span class="p">,</span> <span class="n">ax</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">axs</span><span class="o">.</span><span class="n">flatten</span><span class="p">()):</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">countplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">num_features_binary</span><span class="p">[</span><span class="n">col</span><span class="p">],</span> <span class="n">hue</span><span class="o">=</span><span class="s1">&#39;churn&#39;</span><span class="p">,</span> <span class="n">dodge</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">df</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">axs</span><span class="p">[</span><span class="n">col</span><span class="p">])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">num_features_binary</span><span class="p">[</span><span class="n">col</span><span class="p">])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">get_xticklabels</span><span class="p">(),</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p><br>
<img src = "./images/numerical_bin.png" style="height: 100%; width:100%; display: block; margin-left: auto; margin-right: auto;" /></p>
<h3 id="25-check-outliers">2.5. Check outliers</h3>
<p>For this part, we have to detect outliers in features which are not binary because in binary there is not sense. For this part, we will check with the $ IQR = 1.5(percentile_3 - percentile_1) $.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">detect_outlier</span><span class="p">(</span><span class="n">X</span><span class="p">):</span>
    <span class="s2">&#34;&#34;&#34;
</span><span class="s2">    X: dataframe
</span><span class="s2">    &#34;&#34;&#34;</span>
    <span class="c1">#X = df_new.iloc[:, :-1]</span>
    <span class="c1">#for i in range(len(X.columns)):</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span> <span class="c1"># Only priny the firs 5</span>
        <span class="n">first_q</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="n">X</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="n">i</span><span class="p">]],</span> <span class="mi">25</span><span class="p">)</span>
        <span class="n">third_q</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="n">X</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="n">i</span><span class="p">]],</span> <span class="mi">75</span><span class="p">)</span> 
        <span class="n">IQR</span> <span class="o">=</span> <span class="mf">1.5</span><span class="o">*</span><span class="p">(</span><span class="n">third_q</span> <span class="o">-</span> <span class="n">first_q</span><span class="p">)</span>
        <span class="n">minimum</span> <span class="o">=</span> <span class="n">first_q</span> <span class="o">-</span> <span class="n">IQR</span> 
        <span class="n">maximum</span> <span class="o">=</span> <span class="n">third_q</span> <span class="o">+</span> <span class="n">IQR</span>
        
        <span class="k">if</span><span class="p">(</span><span class="n">minimum</span> <span class="o">&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="n">X</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="n">i</span><span class="p">]])</span> <span class="ow">or</span> <span class="n">maximum</span> <span class="o">&lt;</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="n">X</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="n">i</span><span class="p">]])):</span>
            <span class="k">print</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="s2">&#34;There is Outlier&#34;</span><span class="p">)</span>
<span class="n">detect_outlier</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">num_features_new</span><span class="p">])</span>

<span class="c1"># Output:</span>
<span class="n">age</span> <span class="n">There</span> <span class="ow">is</span> <span class="n">Outlier</span>
<span class="n">deposits</span> <span class="n">There</span> <span class="ow">is</span> <span class="n">Outlier</span>
<span class="n">withdrawal</span> <span class="n">There</span> <span class="ow">is</span> <span class="n">Outlier</span>
<span class="n">purchases_partners</span> <span class="n">There</span> <span class="ow">is</span> <span class="n">Outlier</span>
<span class="n">purchases</span> <span class="n">There</span> <span class="ow">is</span> <span class="n">Outlier</span>
</code></pre></td></tr></table>
</div>
</div><p><img src = "./images/outliers.png" style="height: 100%; width:100%; display: block; margin-left: auto; margin-right: auto;" /></p>
<p>As we can see there are &lsquo;age&rsquo;, &lsquo;purchases_partners&rsquo; and &lsquo;cc_application_begin&rsquo; have outliers. On the other hand, the others its mean is on 0 which means most of all these values are 0. So later during removing outliers, these features will have only one value &lsquo;0&rsquo;. Hence, they should be removed.</p>
<h3 id="26-analysis-of-churn-over-features">2.6. Analysis of Churn over features</h3>
<p>Analysis 1:</p>
<ul>
<li>Question: Whats the main age group of customers ? and Which age group of customers churn more ?</li>
<li>Results: From picture we can see that people between 21 and 32 churn more than older people.</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="n">age_group</span> <span class="o">=</span> <span class="n">df</span><span class="p">[(</span><span class="n">df</span><span class="o">.</span><span class="n">age</span><span class="o">&gt;</span><span class="mi">20</span><span class="p">)</span><span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">age</span><span class="o">&lt;</span><span class="mi">80</span><span class="p">)]</span>
<span class="n">df_filtered</span> <span class="o">=</span> <span class="n">age_group</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;age&#39;</span><span class="p">,</span> <span class="s1">&#39;churn&#39;</span><span class="p">])[</span><span class="s1">&#39;deposits&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">count</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">pivot_table</span><span class="p">(</span><span class="n">df_filtered</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="s1">&#39;deposits&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="s1">&#39;age&#39;</span><span class="p">,</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;churn&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="n">b</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>

<span class="c1"># Output:</span>
<span class="n">churn</span>	<span class="n">age</span>	<span class="mi">0</span>	<span class="mi">1</span>
<span class="mi">0</span>	<span class="mf">21.0</span>	<span class="mf">373.0</span>	<span class="mf">397.0</span>
<span class="mi">1</span>	<span class="mf">22.0</span>	<span class="mf">409.0</span>	<span class="mf">410.0</span>
<span class="mi">2</span>	<span class="mf">23.0</span>	<span class="mf">519.0</span>	<span class="mf">437.0</span>
<span class="mi">3</span>	<span class="mf">24.0</span>	<span class="mf">573.0</span>	<span class="mf">449.0</span>
<span class="mi">4</span>	<span class="mf">25.0</span>	<span class="mf">580.0</span>	<span class="mf">478.0</span>

<span class="c1">#####</span>
<span class="n">sns</span><span class="o">.</span><span class="n">barplot</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="s1">&#39;age&#39;</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="mi">1</span> <span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">b</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Age&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Churn Quantity&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Age Churn Rate&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="mi">90</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p><img src = "./images/churn_age.png" style="height: 70%; width:70%; display: block; margin-left: auto; margin-right: auto;" /></p>
<p>Analysis 2:</p>
<ul>
<li>Question: People who makes deposits churn? or People who makes purchases churn?</li>
<li>Results: We can see from picture that peoplo who does not make any deposit or purchase churn more. It is logic.</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="n">df_filtered</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;deposits&#39;</span><span class="p">,</span> <span class="s1">&#39;churn&#39;</span><span class="p">])[</span><span class="s1">&#39;housing&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">count</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">pivot_table</span><span class="p">(</span><span class="n">df_filtered</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="s1">&#39;housing&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="s1">&#39;deposits&#39;</span><span class="p">,</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;churn&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="n">b</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>

<span class="c1"># Output:</span>

<span class="c1">#####</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">barplot</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="s1">&#39;deposits&#39;</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="mi">1</span> <span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">b</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Deposits&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Churn Quantity&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Depostis Churn Rate&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="mi">90</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p><img src = "./images/churn_deposit.png" style="height: 70%; width:70%; display: block; margin-left: auto; margin-right: auto;" /></p>
<h3 id="27-conclusions-after-exploration-and-analysis">2.7. Conclusions after exploration and analysis</h3>
<p>After EDA, we have some insights and conclusion that must be applied in the pre-processing phase for preparing the data for start modeling:</p>
<ul>
<li>Peoble who does not make any deposits or do any purchase with the app churn more</li>
<li>From picture we can see that people between 21 and 32 churn more than older people.</li>
<li>As we can see there are &lsquo;age&rsquo;, &lsquo;purchases_partners&rsquo; and &lsquo;cc_application_begin&rsquo; have outliers. On the other hand, the others its mean is on 0 which means most of all these values are 0. So later during removing outliers, these features will have only one value &lsquo;0&rsquo;. They should be removed.</li>
<li>&lsquo;waiting_4_loan&rsquo;, &lsquo;cancelled_loan&rsquo;, &lsquo;received_loan&rsquo;, &lsquo;rejected_loan&rsquo;, &lsquo;left_for_one_month&rsquo; have almost the same distribution regarded churn. We will only use one of them.</li>
<li>From correlation matrix, correlation 0.91 between app_web_user and web_user. It means they are positively depended so we can ommit one of them.</li>
<li>From correlation matrix, correlation 0.88 between reward_rate and cc_recommended. It means they are positively depended so we can ommit one of them.</li>
<li>From correlation matrix, correlation -0.84 between android_user and ios_user. It means they are negatively depended so we can ommit one of them.</li>
<li>From correlation matrix, correlation 1 between purchases and deposit. It means they are positively depended so we can ommit one of them.</li>
<li>From Categorical values, The people who has the Bi-weekly payment_type churn more than others.</li>
<li>From Categorical values, The people who Rent(R) churn more than people who Own(O) his home.</li>
<li>From Categorical values, these values should be traslate to numbers with one hot encoding technique in order to keep the size of dataset. There are a lot of  &lsquo;na&rsquo; values. We can remove them using one hot technique(dummy).</li>
<li>As we can see, the ratio of the class variable is almost balanced. SO in this way, we won&rsquo;t need to use any technique for balance them.</li>
<li>We can see that there are some features like &lsquo;deposits&rsquo;, &lsquo;withdrawal&rsquo;, &lsquo;purchases&rsquo;, &lsquo;cc_taken&rsquo;, &lsquo;cc_disliked&rsquo;, &lsquo;cc_liked&rsquo;, &lsquo;registered_phones&rsquo; which has huge values as &lsquo;0&rsquo; than other values. Lated during removing outliers, all the values will be 0, so those features are not useful. We have to remove them.</li>
</ul>
<div style="text-align: right">
  <a href="#indice">⬆</a>
</div>
<hr>
<h2 id="3-pre-processing-a-idsection3a">3. Pre-Processing <a id="section3"></a></h2>
<p>As found in exploration phase, we will pre-process the dataset for being accurate for modelling. All of these steps we will save in a pipeline list for next pre-processing steps. Below the list of task:</p>
<ol>
<li>Remove Null/Nan values</li>
<li>Remove duplicated indexes</li>
<li>Remove not useful features: app_web_user, deposit, ios_user, cc_recommended, cancelled_loan', &lsquo;received_loan&rsquo;, &lsquo;rejected_loan&rsquo;, &lsquo;waiting_4_loan&rsquo; columns</li>
<li>Update numerical and categorical values list for modeling</li>
<li>Remove outliers</li>
<li>Num-Val: Standarize data for training(without binary features)</li>
<li>Cat-Val: One hot encoding</li>
<li>Create pre-process pipeline function for next preprocesing for test data.</li>
</ol>
<p>Before start, we create the pipeline list. At the end of process, we will test this pipeline with a new dataset:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="c1"># Pipeline for pre-preocessing</span>
<span class="n">pipeline_preprocess</span> <span class="o">=</span> <span class="p">[]</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="31-remove-nullnan-values">3.1. Remove Null/Nan values</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">dropnull</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&#34;Removing columns credit_score and rewards_earned ...(1)&#34;</span><span class="p">)</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;credit_score&#39;</span><span class="p">,</span><span class="s1">&#39;rewards_earned&#39;</span><span class="p">])</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&#34;Drop null values from age column ...(2)&#34;</span><span class="p">)</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">notnull</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;age&#39;</span><span class="p">])]</span>
    <span class="k">return</span> <span class="n">df</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">dropnull</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>

<span class="n">null_finder</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="k">print</span><span class="p">(</span><span class="s2">&#34; ***** Number of Null Values by row: ***** &#34;</span><span class="p">)</span>
<span class="n">null_finder</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">null_finder</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>

<span class="c1"># Output:</span>
<span class="n">Removing</span> <span class="n">columns</span> <span class="n">credit_score</span> <span class="ow">and</span> <span class="n">rewards_earned</span> <span class="o">...</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">Drop</span> <span class="n">null</span> <span class="n">values</span> <span class="kn">from</span> <span class="nn">age</span> <span class="nn">column</span> <span class="nn">...</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
 <span class="o">*****</span> <span class="n">Number</span> <span class="n">of</span> <span class="n">Null</span> <span class="n">Values</span> <span class="n">by</span> <span class="n">row</span><span class="p">:</span> <span class="o">*****</span> 
<span class="n">Series</span><span class="p">([],</span> <span class="n">dtype</span><span class="p">:</span> <span class="n">float64</span><span class="p">)</span>

<span class="c1"># Adding to pre-preocessing pipeline:</span>

<span class="n">pipeline_preprocess</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dropnull</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="32-remove-duplicated-indexes">3.2. Remove duplicated indexes</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="c1"># This function will be agregated to the pre-precessing pipeline:</span>
<span class="k">def</span> <span class="nf">dropduplicated</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">is_unique</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s1">&#39;Indexes are unique.&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">df</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s1">&#39;There are duplicated indexes....So removing duplicated indexes ...(3)&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">df</span><span class="p">[</span><span class="o">~</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">duplicated</span><span class="p">(</span><span class="n">keep</span><span class="o">=</span><span class="s1">&#39;first&#39;</span><span class="p">)]</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">dropduplicated</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>


<span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">is_unique</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;Indexes are unique.&#39;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;There are duplicated indexes.&#39;</span><span class="p">)</span>

<span class="c1"># Output:</span>
<span class="n">There</span> <span class="n">are</span> <span class="n">duplicated</span> <span class="n">indexes</span><span class="o">....</span><span class="n">So</span> <span class="n">removing</span> <span class="n">duplicated</span> <span class="n">indexes</span> <span class="o">...</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="n">Indexes</span> <span class="n">are</span> <span class="n">unique</span><span class="o">.</span>

<span class="c1"># Adding to pre-preocessing pipeline:</span>

<span class="n">pipeline_preprocess</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dropduplicated</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="33-remove-unuseful-features">3.3. Remove unuseful features</h3>
<p>During EDA, we conclude that the following features are unusful:</p>
<ul>
<li>app_web_user</li>
<li>deposit</li>
<li>ios_user</li>
<li>cc_recommended</li>
<li>cancelled_loan</li>
<li>received_loan</li>
<li>rejected_loan</li>
<li>waiting_4_loan</li>
<li>withdrawal</li>
<li>purchases</li>
<li>cc_taken</li>
<li>cc_disliked</li>
<li>cc_liked</li>
<li>registered_phones</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="c1"># Remove app_web_user, deposit, ios_user, cc_recommended, cancelled_loan&#39;, &#39;received_loan&#39;, &#39;rejected_loan&#39;, &#39;waiting_4_loan&#39; columns</span>

<span class="k">def</span> <span class="nf">dropcolumns</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&#34;Drop app_web_user, deposit, ios_user, cc_recommended, cancelled_loan&#39;, &#39;received_loan&#39;, &#39;rejected_loan&#39;, &#39;waiting_4_loan&#39; columns ...(4)&#34;</span><span class="p">)</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;app_web_user&#39;</span><span class="p">,</span><span class="s1">&#39;deposits&#39;</span><span class="p">,</span> <span class="s1">&#39;ios_user&#39;</span><span class="p">,</span><span class="s1">&#39;cc_recommended&#39;</span><span class="p">,</span> <span class="s1">&#39;cancelled_loan&#39;</span><span class="p">,</span> <span class="s1">&#39;received_loan&#39;</span><span class="p">,</span> <span class="s1">&#39;rejected_loan&#39;</span><span class="p">,</span> <span class="s1">&#39;waiting_4_loan&#39;</span><span class="p">,</span>
                          <span class="s1">&#39;withdrawal&#39;</span><span class="p">,</span> <span class="s1">&#39;purchases&#39;</span><span class="p">,</span> <span class="s1">&#39;cc_taken&#39;</span><span class="p">,</span> <span class="s1">&#39;cc_disliked&#39;</span><span class="p">,</span> <span class="s1">&#39;cc_liked&#39;</span><span class="p">,</span> <span class="s1">&#39;registered_phones&#39;</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">df</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">dropcolumns</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>

<span class="c1"># Output:</span>
<span class="n">Drop</span> <span class="n">app_web_user</span><span class="p">,</span> <span class="n">deposit</span><span class="p">,</span> <span class="n">ios_user</span><span class="p">,</span> <span class="n">cc_recommended</span><span class="p">,</span> <span class="n">cancelled_loan</span><span class="s1">&#39;, &#39;</span><span class="n">received_loan</span><span class="s1">&#39;, &#39;</span><span class="n">rejected_loan</span><span class="s1">&#39;, &#39;</span><span class="n">waiting_4_loan</span><span class="s1">&#39; columns ...(4)</span>

<span class="c1"># Adding to pre-preocessing pipeline:</span>

<span class="n">pipeline_preprocess</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dropcolumns</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="34-update-numerical-and-categorical-values-list-for-modeling">3.4. Update numerical and categorical values list for modeling</h3>
<p>We need to update numerical and categorical values list before start modeling because some of them were removed form dataset.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="c1"># Update numerical and categorical values for later modeling</span>

<span class="n">cat_features</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">exclude</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">number</span><span class="p">)</span><span class="o">.</span><span class="n">columns</span>
<span class="n">num_features</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">include</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">number</span><span class="p">)</span><span class="o">.</span><span class="n">columns</span>
<span class="k">print</span><span class="p">(</span> <span class="s2">&#34;Quantity of Categorical features: &#34;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">cat_features</span><span class="p">),</span><span class="s2">&#34;</span><span class="se">\n</span><span class="s2">Categorical features: &#34;</span><span class="p">,</span> <span class="n">cat_features</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span> <span class="s2">&#34;</span><span class="se">\n</span><span class="s2">Quantity of Numerical features: &#34;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">num_features</span><span class="p">),</span><span class="s2">&#34;</span><span class="se">\n</span><span class="s2">Numerical features: &#34;</span><span class="p">,</span> <span class="n">num_features</span><span class="p">)</span>

<span class="c1"># Output:</span>
<span class="n">Quantity</span> <span class="n">of</span> <span class="n">Categorical</span> <span class="n">features</span><span class="p">:</span>  <span class="mi">3</span> 
<span class="n">Categorical</span> <span class="n">features</span><span class="p">:</span>  <span class="n">Index</span><span class="p">([</span><span class="s1">&#39;housing&#39;</span><span class="p">,</span> <span class="s1">&#39;payment_type&#39;</span><span class="p">,</span> <span class="s1">&#39;zodiac_sign&#39;</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;object&#39;</span><span class="p">)</span>

<span class="n">Quantity</span> <span class="n">of</span> <span class="n">Numerical</span> <span class="n">features</span><span class="p">:</span>  <span class="mi">11</span> 
<span class="n">Numerical</span> <span class="n">features</span><span class="p">:</span>  <span class="n">Index</span><span class="p">([</span><span class="s1">&#39;churn&#39;</span><span class="p">,</span> <span class="s1">&#39;age&#39;</span><span class="p">,</span> <span class="s1">&#39;purchases_partners&#39;</span><span class="p">,</span> <span class="s1">&#39;cc_application_begin&#39;</span><span class="p">,</span>
       <span class="s1">&#39;app_downloaded&#39;</span><span class="p">,</span> <span class="s1">&#39;web_user&#39;</span><span class="p">,</span> <span class="s1">&#39;android_user&#39;</span><span class="p">,</span> <span class="s1">&#39;left_for_two_month_plus&#39;</span><span class="p">,</span>
       <span class="s1">&#39;left_for_one_month&#39;</span><span class="p">,</span> <span class="s1">&#39;reward_rate&#39;</span><span class="p">,</span> <span class="s1">&#39;is_referred&#39;</span><span class="p">],</span>
      <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;object&#39;</span><span class="p">)</span>

<span class="c1"># Quantity of numerical values:</span>

<span class="n">num_features_new</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">col</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">())</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">,</span> <span class="n">df</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">include</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">number</span><span class="p">)</span><span class="o">.</span><span class="n">columns</span><span class="p">))</span>
<span class="n">num_features_bin</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">col</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">())</span> <span class="o">==</span> <span class="mi">2</span><span class="p">,</span> <span class="n">df</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">include</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">number</span><span class="p">)</span><span class="o">.</span><span class="n">columns</span><span class="p">))</span>

<span class="k">print</span><span class="p">(</span><span class="s2">&#34;Quantity of features greater than 2:&#34;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">num_features_new</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="n">num_features_new</span><span class="p">)</span>
<span class="k">print</span><span class="p">()</span>
<span class="k">print</span><span class="p">(</span><span class="s2">&#34;Quantity of features equal to 2(binary):&#34;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">num_features_bin</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="n">num_features_bin</span><span class="p">)</span>

<span class="c1"># Output:</span>
<span class="n">Quantity</span> <span class="n">of</span> <span class="n">features</span> <span class="n">greater</span> <span class="n">than</span> <span class="mi">2</span><span class="p">:</span> <span class="mi">4</span>
<span class="p">[</span><span class="s1">&#39;age&#39;</span><span class="p">,</span> <span class="s1">&#39;purchases_partners&#39;</span><span class="p">,</span> <span class="s1">&#39;cc_application_begin&#39;</span><span class="p">,</span> <span class="s1">&#39;reward_rate&#39;</span><span class="p">]</span>

<span class="n">Quantity</span> <span class="n">of</span> <span class="n">features</span> <span class="n">equal</span> <span class="n">to</span> <span class="mi">2</span><span class="p">(</span><span class="n">binary</span><span class="p">):</span> <span class="mi">7</span>
<span class="p">[</span><span class="s1">&#39;churn&#39;</span><span class="p">,</span> <span class="s1">&#39;app_downloaded&#39;</span><span class="p">,</span> <span class="s1">&#39;web_user&#39;</span><span class="p">,</span> <span class="s1">&#39;android_user&#39;</span><span class="p">,</span> <span class="s1">&#39;left_for_two_month_plus&#39;</span><span class="p">,</span> <span class="s1">&#39;left_for_one_month&#39;</span><span class="p">,</span> <span class="s1">&#39;is_referred&#39;</span><span class="p">]</span>
</code></pre></td></tr></table>
</div>
</div><p>So now we have the following features quantity:</p>
<ul>
<li>Quantity of Categorical features:  3</li>
<li>Quantity of Numerical features:  11 (4: Not binary, 7; Binary)</li>
</ul>
<h3 id="35-remove-outliers">3.5. Remove outliers</h3>
<p>For removeing outliers, we focus on numerical features which are not binary</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="c1"># Removing outliers</span>
<span class="k">def</span> <span class="nf">remove_outlier</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
    <span class="s2">&#34;&#34;&#34;
</span><span class="s2">    df: dataframe
</span><span class="s2">    &#34;&#34;&#34;</span>
    
    <span class="n">num_features_new</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">col</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">())</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">,</span> <span class="n">df</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">include</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">number</span><span class="p">)</span><span class="o">.</span><span class="n">columns</span><span class="p">))</span>
    <span class="n">outliers</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">num_features_new</span><span class="p">:</span>
        <span class="n">first_q</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">],</span> <span class="mi">25</span><span class="p">)</span>
        <span class="n">third_q</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">],</span> <span class="mi">75</span><span class="p">)</span> 
        <span class="n">IQR</span> <span class="o">=</span> <span class="mf">1.5</span><span class="o">*</span><span class="p">(</span><span class="n">third_q</span> <span class="o">-</span> <span class="n">first_q</span><span class="p">)</span>
        <span class="n">minimum</span> <span class="o">=</span> <span class="n">first_q</span> <span class="o">-</span> <span class="n">IQR</span> 
        <span class="n">maximum</span> <span class="o">=</span> <span class="n">third_q</span> <span class="o">+</span> <span class="n">IQR</span>
        
        <span class="k">if</span><span class="p">(</span><span class="n">minimum</span> <span class="o">&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">])</span> <span class="ow">or</span> <span class="n">maximum</span> <span class="o">&lt;</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">])):</span>
            <span class="n">outliers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">col</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&#34;The outliers are :&#34;</span><span class="p">,</span> <span class="n">outliers</span><span class="p">)</span>
    
    <span class="k">print</span><span class="p">(</span><span class="s2">&#34;Removing outliers ...(5)&#34;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">outliers</span><span class="p">:</span>
        <span class="n">first_q</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">],</span> <span class="mi">25</span><span class="p">)</span>
        <span class="n">third_q</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">],</span> <span class="mi">75</span><span class="p">)</span> 
        <span class="n">IQR</span> <span class="o">=</span> <span class="mf">1.5</span><span class="o">*</span><span class="p">(</span><span class="n">third_q</span> <span class="o">-</span> <span class="n">first_q</span><span class="p">)</span>
        <span class="n">minimum</span> <span class="o">=</span> <span class="n">first_q</span> <span class="o">-</span> <span class="n">IQR</span> 
        <span class="n">maximum</span> <span class="o">=</span> <span class="n">third_q</span> <span class="o">+</span> <span class="n">IQR</span>
    
        <span class="n">median</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">median</span><span class="p">()</span>
    
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">minimum</span><span class="p">,</span> <span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">median</span> 
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">maximum</span><span class="p">,</span> <span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">median</span>
    <span class="k">return</span> <span class="n">df</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">remove_outlier</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>

<span class="c1"># Output:</span>
<span class="n">The</span> <span class="n">outliers</span> <span class="n">are</span> <span class="p">:</span> <span class="p">[</span><span class="s1">&#39;age&#39;</span><span class="p">,</span> <span class="s1">&#39;purchases_partners&#39;</span><span class="p">,</span> <span class="s1">&#39;cc_application_begin&#39;</span><span class="p">,</span> <span class="s1">&#39;reward_rate&#39;</span><span class="p">]</span>
<span class="n">Removing</span> <span class="n">outliers</span> <span class="o">...</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>

<span class="c1"># Adding to pre-preocessing pipeline:</span>

<span class="n">pipeline_preprocess</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">remove_outlier</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="36-num-val-standarize-data">3.6. Num-Val: Standarize data</h3>
<p>For numerical values, we will standarize for training but without considering binary features.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">standardizeNum</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
    <span class="n">standardize</span> <span class="o">=</span> <span class="n">StandardScaler</span><span class="p">()</span>
    <span class="n">num_features</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">include</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">number</span><span class="p">)</span><span class="o">.</span><span class="n">columns</span>
    <span class="n">num_features_new</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">col</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">())</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">,</span> <span class="n">num_features</span><span class="p">))</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&#34;Standarizing Numerical variables ...(6)&#34;</span><span class="p">)</span>
    <span class="n">df</span><span class="p">[</span><span class="n">num_features_new</span><span class="p">]</span> <span class="o">=</span> <span class="n">standardize</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">num_features_new</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">df</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">standardizeNum</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s2">&#34;Size of the dataset:  </span><span class="si">%d</span><span class="s2">&#34;</span> <span class="o">%</span> <span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="k">print</span><span class="p">(</span><span class="s2">&#34;Number of variables: </span><span class="si">%d</span><span class="s2">&#34;</span> <span class="o">%</span> <span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

<span class="c1"># Output:</span>
<span class="n">Standarizing</span> <span class="n">Numerical</span> <span class="n">variables</span> <span class="o">...</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>
<span class="n">Size</span> <span class="n">of</span> <span class="n">the</span> <span class="n">dataset</span><span class="p">:</span>  <span class="mi">20095</span>
<span class="n">Number</span> <span class="n">of</span> <span class="n">variables</span><span class="p">:</span> <span class="mi">14</span>

<span class="c1"># Adding to pre-preocessing pipeline:</span>

<span class="n">pipeline_preprocess</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">standardizeNum</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="37-cat-val-one-hot-encoding">3.7. Cat-Val: One hot encoding</h3>
<p>Doing the one hot encoding task for categorical features. Also removeing &lsquo;na&rsquo; values.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">removedummy</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&#34;Convert categorical values into numbers ...(7)&#34;</span><span class="p">)</span>
    <span class="n">df_new</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">get_dummies</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&#34;Remove Categorical Variables housing_na, zodiac_sign_na, payment_type_na ...(8)&#34;</span><span class="p">)</span>
    <span class="n">df_new</span> <span class="o">=</span> <span class="n">df_new</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;housing_na&#39;</span><span class="p">,</span> <span class="s1">&#39;zodiac_sign_na&#39;</span><span class="p">,</span> <span class="s1">&#39;payment_type_na&#39;</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">df_new</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">removedummy</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s2">&#34;Size of the dataset:  </span><span class="si">%d</span><span class="s2">&#34;</span> <span class="o">%</span> <span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="k">print</span><span class="p">(</span><span class="s2">&#34;Number of variables: </span><span class="si">%d</span><span class="s2">&#34;</span> <span class="o">%</span> <span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

<span class="c1"># Output:</span>
<span class="n">Convert</span> <span class="n">categorical</span> <span class="n">values</span> <span class="n">into</span> <span class="n">numbers</span> <span class="o">...</span><span class="p">(</span><span class="mi">7</span><span class="p">)</span>
<span class="n">Remove</span> <span class="n">Categorical</span> <span class="n">Variables</span> <span class="n">housing_na</span><span class="p">,</span> <span class="n">zodiac_sign_na</span><span class="p">,</span> <span class="n">payment_type_na</span> <span class="o">...</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span>
<span class="n">Size</span> <span class="n">of</span> <span class="n">the</span> <span class="n">dataset</span><span class="p">:</span>  <span class="mi">20095</span>
<span class="n">Number</span> <span class="n">of</span> <span class="n">variables</span><span class="p">:</span> <span class="mi">29</span>

<span class="c1"># Adding to pre-preocessing pipeline:</span>

<span class="n">pipeline_preprocess</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">removedummy</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="38-create-pre-process-pipeline-function">3.8. Create pre-process pipeline function</h3>
<p>During the pre-processing phase, we use functions for do each especific task. These functions later will be used for new dataset like testing or even new data. Hence, we need to save these functions in a pipeline for later preprocesing. Here the list of all the functions we used:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="k">print</span><span class="p">(</span><span class="s2">&#34;</span><span class="se">\n</span><span class="s2">Steps for pre-processing: &#34;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">step</span><span class="p">,</span> <span class="n">function</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">pipeline_preprocess</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&#34;</span><span class="se">\t</span><span class="s2"> {:d}: {:s}&#34;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">step</span><span class="p">,</span> <span class="n">function</span><span class="o">.</span><span class="vm">__name__</span><span class="p">))</span>

<span class="c1"># Output:</span>
<span class="n">Steps</span> <span class="k">for</span> <span class="n">pre</span><span class="o">-</span><span class="n">processing</span><span class="p">:</span> 
	 <span class="mi">0</span><span class="p">:</span> <span class="n">dropnull</span>
	 <span class="mi">1</span><span class="p">:</span> <span class="n">dropduplicated</span>
	 <span class="mi">2</span><span class="p">:</span> <span class="n">dropcolumns</span>
	 <span class="mi">3</span><span class="p">:</span> <span class="n">remove_outlier</span>
	 <span class="mi">4</span><span class="p">:</span> <span class="n">standardizeNum</span>
	 <span class="mi">5</span><span class="p">:</span> <span class="n">removedummy</span>

</code></pre></td></tr></table>
</div>
</div><p>In this way, we create the funcion &lsquo;preprocess_data_pipeline&rsquo; for later pre-processing for new dataset(prediction):</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="c1"># Definition of preprocess_data for an specific dataset:</span>

<span class="k">def</span> <span class="nf">preprocess_data_pipeline</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">pipeline_preprocess</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">step</span><span class="p">,</span> <span class="n">function</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">pipeline_preprocess</span><span class="p">):</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">function</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&#34;Size of the dataset:  </span><span class="si">%d</span><span class="s2">&#34;</span> <span class="o">%</span> <span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&#34;Number of variables: </span><span class="si">%d</span><span class="s2">&#34;</span> <span class="o">%</span> <span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">df</span>
</code></pre></td></tr></table>
</div>
</div><p>Testing the &lsquo;preprocess_data_pipeline&rsquo; function with new dataset:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="n">df_aux</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;../projectChurnRate/Data/churn_data.csv&#39;</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">2100</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">preprocess_data_pipeline</span><span class="p">(</span><span class="n">df_aux</span><span class="p">,</span> <span class="n">pipeline_preprocess</span><span class="p">)</span>

<span class="c1"># Output:</span>
<span class="n">Removing</span> <span class="n">columns</span> <span class="n">credit_score</span> <span class="ow">and</span> <span class="n">rewards_earned</span> <span class="o">...</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">Drop</span> <span class="n">null</span> <span class="n">values</span> <span class="kn">from</span> <span class="nn">age</span> <span class="nn">column</span> <span class="nn">...</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="n">There</span> <span class="n">are</span> <span class="n">duplicated</span> <span class="n">indexes</span><span class="o">....</span><span class="n">So</span> <span class="n">removing</span> <span class="n">duplicated</span> <span class="n">indexes</span> <span class="o">...</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="n">Drop</span> <span class="n">app_web_user</span><span class="p">,</span> <span class="n">deposit</span><span class="p">,</span> <span class="n">ios_user</span><span class="p">,</span> <span class="n">cc_recommended</span><span class="p">,</span> <span class="n">cancelled_loan</span><span class="s1">&#39;, &#39;</span><span class="n">received_loan</span><span class="s1">&#39;, &#39;</span><span class="n">rejected_loan</span><span class="s1">&#39;, &#39;</span><span class="n">waiting_4_loan</span><span class="s1">&#39; columns ...(4)</span>
<span class="n">The</span> <span class="n">outliers</span> <span class="n">are</span> <span class="p">:</span> <span class="p">[</span><span class="s1">&#39;age&#39;</span><span class="p">,</span> <span class="s1">&#39;purchases_partners&#39;</span><span class="p">,</span> <span class="s1">&#39;cc_application_begin&#39;</span><span class="p">,</span> <span class="s1">&#39;reward_rate&#39;</span><span class="p">]</span>
<span class="n">Removing</span> <span class="n">outliers</span> <span class="o">...</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<span class="n">Standarizing</span> <span class="n">Numerical</span> <span class="n">variables</span> <span class="o">...</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>
<span class="n">Convert</span> <span class="n">categorical</span> <span class="n">values</span> <span class="n">into</span> <span class="n">numbers</span> <span class="o">...</span><span class="p">(</span><span class="mi">7</span><span class="p">)</span>
<span class="n">Remove</span> <span class="n">Categorical</span> <span class="n">Variables</span> <span class="n">housing_na</span><span class="p">,</span> <span class="n">zodiac_sign_na</span><span class="p">,</span> <span class="n">payment_type_na</span> <span class="o">...</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span>
<span class="n">Size</span> <span class="n">of</span> <span class="n">the</span> <span class="n">dataset</span><span class="p">:</span>  <span class="mi">2086</span>
<span class="n">Number</span> <span class="n">of</span> <span class="n">variables</span><span class="p">:</span> <span class="mi">29</span>
<span class="n">user</span>  <span class="n">churn</span>	<span class="n">age</span>	<span class="n">housing</span>	<span class="n">purchases_partners</span>	<span class="n">cc_application_begin</span>	<span class="n">app_downloaded</span>	<span class="n">web_user</span>	<span class="n">android_user</span>	<span class="n">payment_type</span>	<span class="n">zodiac_sign</span>	<span class="n">left_for_two_month_plus</span>	<span class="n">left_for_one_month</span>	<span class="n">reward_rate</span>	<span class="n">is_referred</span>
														
<span class="mi">50488</span>	<span class="mi">0</span>	<span class="mf">20.0</span>	<span class="n">R</span>	<span class="mi">29</span>	<span class="mi">8</span>	<span class="mi">1</span>	<span class="mi">0</span>	<span class="mi">1</span>	<span class="n">Bi</span><span class="o">-</span><span class="n">Weekly</span>	<span class="n">Virgo</span>	<span class="mi">0</span>	<span class="mi">0</span>	<span class="mf">0.44</span>	<span class="mi">1</span>
<span class="mi">53603</span>	<span class="mi">0</span>	<span class="mf">38.0</span>	<span class="n">na</span>	<span class="mi">28</span>	<span class="mi">5</span>	<span class="mi">1</span>	<span class="mi">0</span>	<span class="mi">1</span>	<span class="n">Monthly</span>	<span class="n">Sagittarius</span>	<span class="mi">0</span>	<span class="mi">0</span>	<span class="mf">0.67</span>	<span class="mi">1</span>
<span class="mi">42289</span>	<span class="mi">1</span>	<span class="mf">40.0</span>	<span class="n">R</span>	<span class="mi">9</span>	<span class="mi">4</span>	<span class="mi">1</span>	<span class="mi">1</span>	<span class="mi">1</span>	<span class="n">na</span>	<span class="n">Aries</span>	<span class="mi">0</span>	<span class="mi">0</span>	<span class="mf">0.63</span>	<span class="mi">1</span>
<span class="mi">4185</span>	<span class="mi">0</span>	<span class="mf">34.0</span>	<span class="n">na</span>	<span class="mi">0</span>	<span class="mi">4</span>	<span class="mi">1</span>	<span class="mi">1</span>	<span class="mi">0</span>	<span class="n">Bi</span><span class="o">-</span><span class="n">Weekly</span>	<span class="n">Scorpio</span>	<span class="mi">0</span>	<span class="mi">0</span>	<span class="mf">2.07</span>	<span class="mi">0</span>
<span class="mi">12436</span>	<span class="mi">1</span>	<span class="mf">24.0</span>	<span class="n">O</span>	<span class="mi">38</span>	<span class="mi">7</span>	<span class="mi">1</span>	<span class="mi">1</span>	<span class="mi">1</span>	<span class="n">Weekly</span>	<span class="n">Scorpio</span>	<span class="mi">0</span>	<span class="mi">0</span>	<span class="mf">0.73</span>	<span class="mi">1</span>
<span class="o">...</span>	<span class="o">...</span>	<span class="o">...</span>	<span class="o">...</span>	<span class="o">...</span>	<span class="o">...</span>	<span class="o">...</span>	<span class="o">...</span>	<span class="o">...</span>	<span class="o">...</span>	<span class="o">...</span>	<span class="o">...</span>	<span class="o">...</span>	<span class="o">...</span>	<span class="o">...</span>
<span class="mi">23350</span>	<span class="mi">1</span>	<span class="mf">22.0</span>	<span class="n">R</span>	<span class="mi">31</span>	<span class="mi">7</span>	<span class="mi">1</span>	<span class="mi">1</span>	<span class="mi">1</span>	<span class="n">Weekly</span>	<span class="n">Virgo</span>	<span class="mi">1</span>	<span class="mi">0</span>	<span class="mf">0.00</span>	<span class="mi">1</span>
<span class="mi">53737</span>	<span class="mi">0</span>	<span class="mf">43.0</span>	<span class="n">na</span>	<span class="mi">23</span>	<span class="mi">1</span>	<span class="mi">1</span>	<span class="mi">1</span>	<span class="mi">0</span>	<span class="n">Bi</span><span class="o">-</span><span class="n">Weekly</span>	<span class="n">Gemini</span>	<span class="mi">0</span>	<span class="mi">0</span>	<span class="mf">0.50</span>	<span class="mi">0</span>
<span class="mi">56724</span>	<span class="mi">1</span>	<span class="mf">40.0</span>	<span class="n">R</span>	<span class="mi">0</span>	<span class="mi">0</span>	<span class="mi">1</span>	<span class="mi">1</span>	<span class="mi">0</span>	<span class="n">Monthly</span>	<span class="n">Taurus</span>	<span class="mi">0</span>	<span class="mi">0</span>	<span class="mf">0.30</span>	<span class="mi">0</span>
<span class="mi">17737</span>	<span class="mi">1</span>	<span class="mf">23.0</span>	<span class="n">na</span>	<span class="mi">8</span>	<span class="mi">1</span>	<span class="mi">1</span>	<span class="mi">1</span>	<span class="mi">1</span>	<span class="n">Semi</span><span class="o">-</span><span class="n">Monthly</span>	<span class="n">Pisces</span>	<span class="mi">0</span>	<span class="mi">0</span>	<span class="mf">0.65</span>	<span class="mi">0</span>
<span class="mi">46045</span>	<span class="mi">1</span>	<span class="mf">27.0</span>	<span class="n">R</span>	<span class="mi">0</span>	<span class="mi">3</span>	<span class="mi">1</span>	<span class="mi">0</span>	<span class="mi">0</span>	<span class="n">Bi</span><span class="o">-</span><span class="n">Weekly</span>	<span class="n">Virgo</span>	<span class="mi">0</span>	<span class="mi">0</span>	<span class="mf">0.53</span>	<span class="mi">0</span>
<span class="mi">2086</span> <span class="n">rows</span> <span class="err">×</span> <span class="mi">14</span> <span class="n">columns</span>

</code></pre></td></tr></table>
</div>
</div><div style="text-align: right">
  <a href="#indice">⬆</a>
</div>
<hr>
<p><a id="section4"></a></p>
<h2 id="4-model-and-evaluation">4. Model and Evaluation</h2>
<p>For modeling, we faced the following faces:</p>
<ol>
<li>Separate dataset</li>
</ol>
<ul>
<li>For X and y classes.</li>
<li>Split dataset for training and testing.</li>
</ul>
<ol start="2">
<li>Feature Selection</li>
</ol>
<ul>
<li>Use linear regression model</li>
<li>Use other techniques like: RFE,Random Forest and Mutual Information</li>
</ul>
<ul>
<li>Then sum up and choose the most important features</li>
</ul>
<ol start="3">
<li>Modeling for finding the best:</li>
</ol>
<ul>
<li>Hyperparameter Tunning using GridSearchCV for finding the best hyperparameters of each model</li>
<li>Fitting and Evaluation using the next models: Logistic Regresion, Decision Tree, Support Vector Machine, Random Forest, Nearest Neighbor.</li>
<li>Choose the best model according metrics</li>
<li>Save the model to used with new values</li>
</ul>
<p>For evaluation, we are using the following metrics:</p>
<ul>
<li>Confusion matrix</li>
<li>Accuracy as classification metric</li>
<li>Precision, Recall, F1-score</li>
<li>Some graphs like ROC, Precision vs Recall, KS Statistic Test, Cummulative Gain, Lift Curve.</li>
</ul>
<div class="mermaid">
    
graph LR;
   A[Training Dataset] --> B[Feature Selection] 
   B --> D[Hyper-paremter Tunning]
   D --> E[Fitting]
   E --> F[Model]
   F -->|Tunning| D

</div>
<div class="mermaid">
    
graph LR;
   C[Testing Dataset] --> F[Model Fitted]
   F --> G[Evaluation]
   G --> H[Metrics Insgiths]

</div>
<h3 id="41-dataset-separation">4.1. Dataset Separation</h3>
<p>Here first, we split the data for features and label(churn variable). Then split for training and testing.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="n">X</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;churn&#39;</span><span class="p">,</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;churn&#39;</span><span class="p">]</span> 
<span class="n">x_train</span><span class="p">,</span> <span class="n">x_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">stratify</span><span class="o">=</span><span class="n">y</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s2">&#34;x_train shape: {}&#34;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">x_train</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="s2">&#34;y_train shape: {}&#34;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">y_train</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="s2">&#34;x_test shape: {}&#34;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">x_test</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>

<span class="c1"># Output:</span>
<span class="n">x_train</span> <span class="n">shape</span><span class="p">:</span> <span class="p">(</span><span class="mi">14066</span><span class="p">,</span> <span class="mi">28</span><span class="p">)</span>
<span class="n">y_train</span> <span class="n">shape</span><span class="p">:</span> <span class="p">(</span><span class="mi">14066</span><span class="p">,)</span>
<span class="n">x_test</span> <span class="n">shape</span><span class="p">:</span> <span class="p">(</span><span class="mi">6029</span><span class="p">,</span> <span class="mi">28</span><span class="p">)</span>
<span class="n">y_test</span> <span class="n">shape</span><span class="p">:</span> <span class="p">(</span><span class="mi">6029</span><span class="p">,)</span>

</code></pre></td></tr></table>
</div>
</div><h3 id="42-feature-selection">4.2. Feature Selection</h3>
<p>For Feature Selection, we will use the following techniques:</p>
<ol>
<li>Use linear regression model</li>
<li>Use other techniques like:</li>
</ol>
<ul>
<li>Recursive Feature Elimination (RFE) as a wrapped method</li>
<li>Random Forest as embeded method</li>
<li>Mutual Information classification as entropy method</li>
</ul>
<ol start="3">
<li>Then sum up and choose the most important features</li>
</ol>
<h4 id="421-logistic-regression">4.2.1. Logistic Regression</h4>
<p>Using this model, the more important features with coef &lt; -0.2 and coef &gt; 0.2. There is 7 features from 28. We can see that the more important variables are:</p>
<ul>
<li>left_for_one_month</li>
<li>web_user</li>
<li>app_downloaded</li>
<li>payment_type_Weekly</li>
<li>housing_O</li>
<li>reward_rate</li>
<li>purchases_partners</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="n">feature_importance_lr</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">feature_importance_lr</span><span class="p">[</span><span class="s2">&#34;coef&#34;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mf">0.2</span><span class="p">)</span><span class="o">|</span><span class="p">(</span><span class="n">feature_importance_lr</span><span class="p">[</span><span class="s2">&#34;coef&#34;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.2</span><span class="p">))</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>

<span class="c1"># Output:</span>
                    <span class="n">feature</span>	     <span class="n">coef</span>
 <span class="mi">7</span>	 <span class="n">left_for_one_month</span>      <span class="mf">0.438657</span>
 <span class="mi">4</span>	           <span class="n">web_user</span>      <span class="mf">0.289608</span>
 <span class="mi">3</span>           <span class="n">app_downloaded</span>      <span class="mf">0.268084</span>
<span class="mi">15</span>	<span class="n">payment_type_Weekly</span>      <span class="mf">0.218277</span>
<span class="mi">10</span>	          <span class="n">housing_O</span>     <span class="o">-</span><span class="mf">0.204331</span>
 <span class="mi">8</span>              <span class="n">reward_rate</span>     <span class="o">-</span><span class="mf">0.298566</span>
 <span class="mi">1</span>	 <span class="n">purchases_partners</span>     <span class="o">-</span><span class="mf">0.538643</span>
    

</code></pre></td></tr></table>
</div>
</div><p><img src = "./images/featureImportance.png" style="height: 50%; width:70%; display: block; margin-left: auto; margin-right: auto;" /></p>
<h4 id="422-recursive-feature-elimination-rfe">4.2.2. Recursive Feature Elimination (RFE)</h4>
<p>As a wrapped method, it use an external method or estimator(LogisticRegression in our case) for searching/select in a recursive way a small subset of features evaluating the importance. Using RFE model, the 12 more important features are:</p>
<ul>
<li>purchases_partners</li>
<li>app_downloaded</li>
<li>web_user</li>
<li>left_for_two_month_plus</li>
<li>left_for_one_month</li>
<li>reward_rate</li>
<li>housing_O</li>
<li>payment_type_Weekly</li>
<li>zodiac_sign_Aquarius</li>
<li>zodiac_sign_Capricorn</li>
<li>zodiac_sign_Libra</li>
<li>zodiac_sign_Taurus</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="c1"># Number of features as 12</span>
<span class="n">rfe_selector</span> <span class="o">=</span> <span class="n">RFE</span><span class="p">(</span><span class="n">estimator</span><span class="o">=</span><span class="n">LogisticRegression</span><span class="p">(),</span> <span class="n">n_features_to_select</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="n">rfe_selector</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">x_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
<span class="n">rfe_support</span> <span class="o">=</span> <span class="n">rfe_selector</span><span class="o">.</span><span class="n">get_support</span><span class="p">()</span>
<span class="n">feature_rfe</span> <span class="o">=</span> <span class="n">x_train</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="n">rfe_support</span><span class="p">]</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
<span class="k">print</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">feature_rfe</span><span class="p">)),</span> <span class="s1">&#39;selected features&#39;</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">feature_rfe</span><span class="p">)</span>

<span class="c1"># Output:</span>
<span class="n">Fitting</span> <span class="n">estimator</span> <span class="k">with</span> <span class="mi">28</span> <span class="n">features</span><span class="o">.</span>
<span class="n">Fitting</span> <span class="n">estimator</span> <span class="k">with</span> <span class="mi">18</span> <span class="n">features</span><span class="o">.</span>
<span class="mi">12</span> <span class="n">selected</span> <span class="n">features</span>
<span class="p">[</span><span class="s1">&#39;purchases_partners&#39;</span><span class="p">,</span> <span class="s1">&#39;app_downloaded&#39;</span><span class="p">,</span> <span class="s1">&#39;web_user&#39;</span><span class="p">,</span> <span class="s1">&#39;left_for_two_month_plus&#39;</span><span class="p">,</span> <span class="s1">&#39;left_for_one_month&#39;</span><span class="p">,</span> <span class="s1">&#39;reward_rate&#39;</span><span class="p">,</span> <span class="s1">&#39;housing_O&#39;</span><span class="p">,</span> <span class="s1">&#39;payment_type_Weekly&#39;</span><span class="p">,</span> <span class="s1">&#39;zodiac_sign_Aquarius&#39;</span><span class="p">,</span> <span class="s1">&#39;zodiac_sign_Capricorn&#39;</span><span class="p">,</span> <span class="s1">&#39;zodiac_sign_Libra&#39;</span><span class="p">,</span> <span class="s1">&#39;zodiac_sign_Taurus&#39;</span><span class="p">]</span>

</code></pre></td></tr></table>
</div>
</div><h4 id="423-random-forest">4.2.3. Random Forest</h4>
<p>In Random Forest, there is the purity of the node which tell us about the importance of the model. So if a node with low imputiry(Gini impurity) over all trees, this node will be the most important. Using the Random Forest model, there are only 4 important features:</p>
<ul>
<li>age</li>
<li>purchases_partners</li>
<li>cc_application_begin</li>
<li>reward_rate</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="n">mbeded_rf_selector</span> <span class="o">=</span> <span class="n">SelectFromModel</span><span class="p">(</span><span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">n_estimators</span><span class="o">=</span><span class="mi">100</span><span class="p">),</span> <span class="n">max_features</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">embeded_rf_selector</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">x_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>

<span class="n">embeded_rf_support</span> <span class="o">=</span> <span class="n">embeded_rf_selector</span><span class="o">.</span><span class="n">get_support</span><span class="p">()</span>
<span class="n">feature_embeded_rf</span> <span class="o">=</span> <span class="n">x_train</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="n">embeded_rf_support</span><span class="p">]</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
<span class="k">print</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">feature_embeded_rf</span><span class="p">)),</span> <span class="s1">&#39;selected features&#39;</span><span class="p">)</span>
<span class="n">feature_embeded_rf</span>

<span class="c1"># Output:</span>
<span class="mi">4</span> <span class="n">selected</span> <span class="n">features</span>
<span class="p">[</span><span class="s1">&#39;age&#39;</span><span class="p">,</span> <span class="s1">&#39;purchases_partners&#39;</span><span class="p">,</span> <span class="s1">&#39;cc_application_begin&#39;</span><span class="p">,</span> <span class="s1">&#39;reward_rate&#39;</span><span class="p">]</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="424-mutual-information-classification">4.2.4. Mutual Information classification</h4>
<p>Mutual Information comes from information theory which apply information gain(like decision tree) to feature selection. This gain is calculated between 2 variables and it measures the reduction in uncertainty. Using this model, we can get the first 12 important features:</p>
<ul>
<li>purchases_partners</li>
<li>reward_rate</li>
<li>zodiac_sign_Leo</li>
<li>is_referred</li>
<li>cc_application_begin</li>
<li>android_user</li>
<li>zodiac_sign_Scorpio</li>
<li>housing_O</li>
<li>zodiac_sign_Aquarius</li>
<li>housing_R</li>
<li>app_downloaded</li>
<li>zodiac_sign_Virgo</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="n">importances</span> <span class="o">=</span>  <span class="n">mutual_info_classif</span><span class="p">(</span><span class="n">x_train</span><span class="p">,</span><span class="n">y_train</span><span class="p">)</span>
<span class="n">feature_mutual_importance</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">importances</span><span class="p">,</span> <span class="n">index</span> <span class="o">=</span> <span class="n">x_train</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
<span class="n">feature_mutual_importance</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>

<span class="n">feature_mutual</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">feature_mutual_importance</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">feature_mutual_importance</span> <span class="o">&gt;</span> <span class="mf">0.002</span><span class="p">)</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s2">&#34;There are {} important features and they are: </span><span class="se">\n</span><span class="s2">&#34;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">feature_mutual</span><span class="p">)))</span>
<span class="n">feature_mutual</span>

<span class="c1"># Output:</span>
<span class="n">There</span> <span class="n">are</span> <span class="mi">12</span> <span class="n">important</span> <span class="n">features</span> <span class="ow">and</span> <span class="n">they</span> <span class="n">are</span><span class="p">:</span> 

<span class="p">[</span><span class="s1">&#39;purchases_partners&#39;</span><span class="p">,</span>
 <span class="s1">&#39;reward_rate&#39;</span><span class="p">,</span>
 <span class="s1">&#39;zodiac_sign_Leo&#39;</span><span class="p">,</span>
 <span class="s1">&#39;is_referred&#39;</span><span class="p">,</span>
 <span class="s1">&#39;cc_application_begin&#39;</span><span class="p">,</span>
 <span class="s1">&#39;android_user&#39;</span><span class="p">,</span>
 <span class="s1">&#39;zodiac_sign_Scorpio&#39;</span><span class="p">,</span>
 <span class="s1">&#39;housing_O&#39;</span><span class="p">,</span>
 <span class="s1">&#39;zodiac_sign_Aquarius&#39;</span><span class="p">,</span>
 <span class="s1">&#39;housing_R&#39;</span><span class="p">,</span>
 <span class="s1">&#39;app_downloaded&#39;</span><span class="p">,</span>
 <span class="s1">&#39;zodiac_sign_Virgo&#39;</span><span class="p">]</span>

</code></pre></td></tr></table>
</div>
</div><p><br>
Here we can see the most importan feature vs churn. We can see the &ldquo;purchases_partners&rdquo; is the most influence.</p>
<p><img src = "./images/featureImportance2.png" style="height: 50%; width:70%; display: block; margin-left: auto; margin-right: auto;" /></p>
<h4 id="425-summary">4.2.5. Summary</h4>
<p>Sum up all the results, we can get the 12 most important features for start modeling.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="c1"># put all selection together</span>
<span class="n">feature_selection_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;Feature&#39;</span><span class="p">:</span><span class="n">x_train</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> 
                                     <span class="s1">&#39;Logistics&#39;</span><span class="p">:</span><span class="n">lr_support</span><span class="p">,</span>
                                     <span class="s1">&#39;RFE&#39;</span><span class="p">:</span><span class="n">rfe_support</span><span class="p">,</span>
                                     <span class="s1">&#39;Random Forest&#39;</span><span class="p">:</span><span class="n">embeded_rf_support</span><span class="p">,</span> <span class="s1">&#39;Mutual Classif&#39;</span><span class="p">:</span><span class="n">mutual_support</span><span class="p">})</span>
<span class="c1"># count the selected times for each feature</span>
<span class="n">feature_selection_df</span><span class="p">[</span><span class="s1">&#39;Total&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">feature_selection_df</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># display the top 100</span>
<span class="n">feature_selection_df</span> <span class="o">=</span> <span class="n">feature_selection_df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">([</span><span class="s1">&#39;Total&#39;</span><span class="p">,</span><span class="s1">&#39;Feature&#39;</span><span class="p">]</span> <span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
<span class="c1"># feature_selection_df.index = range(1, len(feature_selection_df)+1)</span>
<span class="n">feature_selection_df</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="n">num_feats</span><span class="p">)</span>

<span class="c1"># Output:</span>
	<span class="n">Feature</span>	<span class="n">Logistics</span>	<span class="n">RFE</span>	<span class="n">Random</span> <span class="n">Forest</span>	<span class="n">Mutual</span> <span class="n">Classif</span>	<span class="n">Total</span>
<span class="mi">1</span>	<span class="n">purchases_partners</span>	<span class="bp">True</span>	<span class="bp">True</span>	<span class="bp">True</span>	<span class="bp">True</span>	        <span class="mi">4</span>
<span class="mi">8</span>	<span class="n">reward_rate</span>	        <span class="bp">False</span>	<span class="bp">True</span>	<span class="bp">True</span>	<span class="bp">True</span>	        <span class="mi">3</span>
<span class="mi">2</span>	<span class="n">cc_application_begin</span>	<span class="bp">True</span>	<span class="bp">False</span>	<span class="bp">True</span>	<span class="bp">True</span>	        <span class="mi">3</span>
<span class="mi">3</span>	<span class="n">app_downloaded</span>	        <span class="bp">True</span>	<span class="bp">True</span>	<span class="bp">False</span>	<span class="bp">True</span>	        <span class="mi">3</span>
<span class="mi">27</span>	<span class="n">zodiac_sign_Virgo</span>	<span class="bp">True</span>	<span class="bp">False</span>	<span class="bp">False</span>	<span class="bp">True</span>	        <span class="mi">2</span>
<span class="mi">26</span>	<span class="n">zodiac_sign_Taurus</span>	<span class="bp">True</span>	<span class="bp">True</span>	<span class="bp">False</span>	<span class="bp">False</span>	        <span class="mi">2</span>
<span class="mi">25</span>	<span class="n">zodiac_sign_Scorpio</span>	<span class="bp">True</span>	<span class="bp">False</span>	<span class="bp">False</span>	<span class="bp">True</span>	        <span class="mi">2</span>
<span class="mi">16</span>	<span class="n">zodiac_sign_Aquarius</span>	<span class="bp">False</span>	<span class="bp">True</span>	<span class="bp">False</span>	<span class="bp">True</span>	        <span class="mi">2</span>
<span class="mi">10</span>	<span class="n">housing_O</span>	        <span class="bp">False</span>	<span class="bp">True</span>	<span class="bp">False</span>	<span class="bp">True</span>	        <span class="mi">2</span>
<span class="mi">0</span>	<span class="n">age</span>	                <span class="bp">True</span>	<span class="bp">False</span>	<span class="bp">True</span>	<span class="bp">False</span>	        <span class="mi">2</span>
<span class="mi">22</span>	<span class="n">zodiac_sign_Libra</span>	<span class="bp">False</span>	<span class="bp">True</span>	<span class="bp">False</span>	<span class="bp">False</span>	        <span class="mi">1</span>
<span class="mi">21</span>	<span class="n">zodiac_sign_Leo</span>	        <span class="bp">False</span>	<span class="bp">False</span>	<span class="bp">False</span>	<span class="bp">True</span>	        <span class="mi">1</span>

</code></pre></td></tr></table>
</div>
</div><p><br>
Here they are:</p>
<ul>
<li>purchases_partners</li>
<li>reward_rate</li>
<li>cc_application_begin</li>
<li>app_downloaded</li>
<li>zodiac_sign_Virgo</li>
<li>zodiac_sign_Taurus</li>
<li>zodiac_sign_Scorpio</li>
<li>zodiac_sign_Aquarius</li>
<li>housing_O</li>
<li>age</li>
<li>zodiac_sign_Libra</li>
<li>zodiac_sign_Leo</li>
</ul>
<p>Now we are ready to start modeling. For this we split again the dataset but filtering using the <strong>new_num_features</strong> list.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="n">X</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="n">new_num_features</span><span class="p">]</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;churn&#39;</span><span class="p">]</span>
<span class="n">x_train</span><span class="p">,</span> <span class="n">x_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">stratify</span><span class="o">=</span><span class="n">y</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s2">&#34;x_train shape: {}&#34;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">x_train</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="s2">&#34;y_train shape: {}&#34;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">y_train</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="s2">&#34;x_test shape: {}&#34;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">x_test</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="s2">&#34;y_test shape: {}&#34;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">y_test</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>

<span class="c1"># Output:</span>
<span class="n">x_train</span> <span class="n">shape</span><span class="p">:</span> <span class="p">(</span><span class="mi">14066</span><span class="p">,</span> <span class="mi">12</span><span class="p">)</span>
<span class="n">y_train</span> <span class="n">shape</span><span class="p">:</span> <span class="p">(</span><span class="mi">14066</span><span class="p">,)</span>
<span class="n">x_test</span> <span class="n">shape</span><span class="p">:</span> <span class="p">(</span><span class="mi">6029</span><span class="p">,</span> <span class="mi">12</span><span class="p">)</span>
<span class="n">y_test</span> <span class="n">shape</span><span class="p">:</span> <span class="p">(</span><span class="mi">6029</span><span class="p">,)</span>

</code></pre></td></tr></table>
</div>
</div><div style="text-align: right">
  <a href="#indice">⬆</a>
</div>
<hr>
<h3 id="43-modeling--evaluation">4.3. Modeling &amp; Evaluation</h3>
<p>Modeling for finding the best:</p>
<ol>
<li>Hyperparameter Tunning using GridSearchCV for finding the best hyperparameters of each model</li>
<li>Fitting and Evaluation using the next models:</li>
</ol>
<ul>
<li>Logistic Regresion Model</li>
<li>Decision Tree Model</li>
<li>Support Vector Machine Model</li>
<li>Random Forest Model</li>
<li>K-Nearest Neighbor Model</li>
</ul>
<ol start="3">
<li>Choose the best model according metrics</li>
<li>Save the model to used with new values</li>
</ol>
<p>For evaluation, we are using the following metrics:</p>
<ul>
<li>Confusion matrix</li>
<li>Accuracy as classification metric</li>
<li>Precision, Recall, F1-score</li>
<li>Some graphs like ROC, Precision vs Recall, KS Statistic Test, Cummulative Gain, Lift Curve.</li>
</ul>
<p>Most of the steps for this phase are mechanic, so we create some key points to be considered:</p>
<div class="mermaid">
    
graph LR;
    A[Training Dataset] --> B[GridSearchCV]
    B -->|Hyperparameter Tunning| C[Fitting/Predicting]
    C --> B
    C -->|Evaluation Metrics| D[Save Metrics]

</div>
<p>Also we create 2 functions to summary all the results during tunning hyperparameters and modeling(fit/predict):</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">GridSearchResults</span><span class="p">(</span><span class="n">grid_clf</span><span class="p">,</span> <span class="n">num_results</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">display_all_params</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="s2">&#34;&#34;&#34;
</span><span class="s2">    Function to summary all the results of gridsearchCV.
</span><span class="s2">    &#34;&#34;&#34;</span>
<span class="k">def</span> <span class="nf">evaluationMetricsGCV</span><span class="p">(</span><span class="n">x_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">,</span> <span class="n">model_fit</span><span class="p">):</span>
    <span class="s2">&#34;&#34;&#34;
</span><span class="s2">    Function to summary all the results of fitting and predicting.
</span><span class="s2">    &#34;&#34;&#34;</span>
</code></pre></td></tr></table>
</div>
</div><p><br>
To save metrics, we create a dataframe for later usage and to choose the best model:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="c1"># Dataframe for statistics</span>

<span class="n">model_stats</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&#34;Model&#34;</span><span class="p">,</span> <span class="s2">&#34;Accuracy&#34;</span><span class="p">,</span> <span class="s2">&#34;Precision&#34;</span><span class="p">,</span> <span class="s2">&#34;Recall&#34;</span><span class="p">,</span> <span class="s2">&#34;F1-Score&#34;</span><span class="p">,</span> <span class="s2">&#34;AUC-Score&#34;</span><span class="p">])</span>
<span class="n">model_stats</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>

<span class="c1"># Output:</span>
<span class="n">Model</span>	<span class="n">Accuracy</span>	<span class="n">Precision</span>	<span class="n">Recall</span>	<span class="n">F1</span><span class="o">-</span><span class="n">Score</span>	<span class="n">AUC</span><span class="o">-</span><span class="n">Score</span>

</code></pre></td></tr></table>
</div>
</div><h3 id="431-logistic-regresion-model">4.3.1. Logistic Regresion Model</h3>
<p>Here the results for hyperparameter tunning:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="c1"># GridSearchCV for logistic Regression</span>

<span class="n">parameters</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;C&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mf">10e-3</span><span class="p">,</span> <span class="mf">10e-2</span><span class="p">,</span> <span class="mf">10e-1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">1000</span><span class="p">]</span>
<span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;class_weight&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="bp">None</span><span class="p">,</span> <span class="s1">&#39;balanced&#39;</span><span class="p">]</span>
<span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;penalty&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&#34;l1&#34;</span><span class="p">,</span><span class="s2">&#34;l2&#34;</span><span class="p">,</span><span class="s1">&#39;elasticnet&#39;</span><span class="p">]</span>
<span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;solver&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;newton-cg&#39;</span><span class="p">,</span> <span class="s1">&#39;lbfgs&#39;</span><span class="p">,</span> <span class="s1">&#39;liblinear&#39;</span><span class="p">,</span> <span class="s1">&#39;sag&#39;</span><span class="p">]</span>

<span class="n">GS_log</span> <span class="o">=</span> <span class="n">GridSearchCV</span><span class="p">(</span><span class="n">LogisticRegression</span><span class="p">(),</span> <span class="n">parameters</span> <span class="p">,</span> <span class="n">scoring</span> <span class="o">=</span> <span class="s1">&#39;accuracy&#39;</span><span class="p">,</span> <span class="n">cv</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
<span class="n">GS_log</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">x_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>

<span class="n">GridSearchResults</span><span class="p">(</span><span class="n">GS_log</span><span class="p">)</span>

<span class="c1"># Output:</span>
<span class="n">Best</span> <span class="n">parameters</span><span class="p">:</span> 
 <span class="p">{</span><span class="s1">&#39;C&#39;</span><span class="p">:</span> <span class="mf">0.01</span><span class="p">,</span> <span class="s1">&#39;class_weight&#39;</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span> <span class="s1">&#39;penalty&#39;</span><span class="p">:</span> <span class="s1">&#39;l1&#39;</span><span class="p">,</span> <span class="s1">&#39;solver&#39;</span><span class="p">:</span> <span class="s1">&#39;liblinear&#39;</span><span class="p">}</span>
<span class="n">Best</span> <span class="n">score</span><span class="p">:</span> 
 <span class="mf">0.63038</span> <span class="p">(</span><span class="o">+/-</span><span class="mf">0.01300</span><span class="p">)</span>
<span class="n">All</span> <span class="n">parameters</span><span class="p">:</span> 
<span class="p">{</span><span class="s1">&#39;C&#39;</span><span class="p">:</span> <span class="mf">0.01</span><span class="p">,</span>
 <span class="s1">&#39;class_weight&#39;</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span>
 <span class="s1">&#39;dual&#39;</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span>
 <span class="s1">&#39;fit_intercept&#39;</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span>
 <span class="s1">&#39;intercept_scaling&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
 <span class="s1">&#39;l1_ratio&#39;</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span>
 <span class="s1">&#39;max_iter&#39;</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span>
 <span class="s1">&#39;multi_class&#39;</span><span class="p">:</span> <span class="s1">&#39;auto&#39;</span><span class="p">,</span>
 <span class="s1">&#39;n_jobs&#39;</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span>
 <span class="s1">&#39;penalty&#39;</span><span class="p">:</span> <span class="s1">&#39;l1&#39;</span><span class="p">,</span>
 <span class="s1">&#39;random_state&#39;</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span>
 <span class="s1">&#39;solver&#39;</span><span class="p">:</span> <span class="s1">&#39;liblinear&#39;</span><span class="p">,</span>
 <span class="s1">&#39;tol&#39;</span><span class="p">:</span> <span class="mf">0.0001</span><span class="p">,</span>
 <span class="s1">&#39;verbose&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
 <span class="s1">&#39;warm_start&#39;</span><span class="p">:</span> <span class="bp">False</span><span class="p">}</span>
                                                <span class="n">params</span>	    <span class="n">mean_test_score</span>	<span class="n">std_test_score</span>	<span class="n">rank_test_score</span>
<span class="mi">2</span>	<span class="p">{</span><span class="s1">&#39;C&#39;</span><span class="p">:</span> <span class="mf">0.01</span><span class="p">,</span> <span class="s1">&#39;class_weight&#39;</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span> <span class="s1">&#39;penalty&#39;</span><span class="p">:</span> <span class="s1">&#39;...	0.630383	0.012998	1</span>
<span class="mi">6</span>	<span class="p">{</span><span class="s1">&#39;C&#39;</span><span class="p">:</span> <span class="mf">0.01</span><span class="p">,</span> <span class="s1">&#39;class_weight&#39;</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span> <span class="s1">&#39;penalty&#39;</span><span class="p">:</span> <span class="s1">&#39;...	0.627824	0.013089	2</span>
<span class="mi">26</span>	<span class="p">{</span><span class="s1">&#39;C&#39;</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">,</span> <span class="s1">&#39;class_weight&#39;</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span> <span class="s1">&#39;penalty&#39;</span><span class="p">:</span> <span class="s1">&#39;l...	0.627611	0.012696	3</span>
<span class="mi">4</span>	<span class="p">{</span><span class="s1">&#39;C&#39;</span><span class="p">:</span> <span class="mf">0.01</span><span class="p">,</span> <span class="s1">&#39;class_weight&#39;</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span> <span class="s1">&#39;penalty&#39;</span><span class="p">:</span> <span class="s1">&#39;...	0.627469	0.012713	4</span>
<span class="mi">5</span>	<span class="p">{</span><span class="s1">&#39;C&#39;</span><span class="p">:</span> <span class="mf">0.01</span><span class="p">,</span> <span class="s1">&#39;class_weight&#39;</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span> <span class="s1">&#39;penalty&#39;</span><span class="p">:</span> <span class="s1">&#39;...	0.627469	0.012713	4</span>
<span class="mi">7</span>	<span class="p">{</span><span class="s1">&#39;C&#39;</span><span class="p">:</span> <span class="mf">0.01</span><span class="p">,</span> <span class="s1">&#39;class_weight&#39;</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span> <span class="s1">&#39;penalty&#39;</span><span class="p">:</span> <span class="s1">&#39;...	0.627469	0.012713	4</span>
<span class="mi">29</span>	<span class="p">{</span><span class="s1">&#39;C&#39;</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">,</span> <span class="s1">&#39;class_weight&#39;</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span> <span class="s1">&#39;penalty&#39;</span><span class="p">:</span> <span class="s1">&#39;l...	0.627184	0.013151	7</span>
<span class="mi">31</span>	<span class="p">{</span><span class="s1">&#39;C&#39;</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">,</span> <span class="s1">&#39;class_weight&#39;</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span> <span class="s1">&#39;penalty&#39;</span><span class="p">:</span> <span class="s1">&#39;l...	0.627184	0.013151	7</span>
<span class="mi">28</span>	<span class="p">{</span><span class="s1">&#39;C&#39;</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">,</span> <span class="s1">&#39;class_weight&#39;</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span> <span class="s1">&#39;penalty&#39;</span><span class="p">:</span> <span class="s1">&#39;l...	0.627184	0.013151	7</span>
<span class="mi">30</span>	<span class="p">{</span><span class="s1">&#39;C&#39;</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">,</span> <span class="s1">&#39;class_weight&#39;</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span> <span class="s1">&#39;penalty&#39;</span><span class="p">:</span> <span class="s1">&#39;l...	0.626971	0.013364	10</span>
</code></pre></td></tr></table>
</div>
</div><p><br>
Here the result for modeling and evaluation:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="n">logr_model</span> <span class="o">=</span> <span class="n">LogisticRegression</span><span class="p">(</span><span class="n">C</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">class_weight</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">max_iter</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">penalty</span><span class="o">=</span><span class="s1">&#39;l1&#39;</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">solver</span><span class="o">=</span><span class="s1">&#39;liblinear&#39;</span><span class="p">)</span>
<span class="n">logr_model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">x_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>

<span class="n">Accuracy</span><span class="p">,</span> <span class="n">Precision</span><span class="p">,</span> <span class="n">Recall</span><span class="p">,</span> <span class="n">F1</span><span class="p">,</span> <span class="n">auc_score</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">,</span> <span class="n">y_prob</span> <span class="o">=</span> <span class="n">evaluationMetricsGCV</span><span class="p">(</span><span class="n">x_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">,</span> <span class="n">logr_model</span><span class="p">)</span>
<span class="n">model_stats</span> <span class="o">=</span> <span class="n">model_stats</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&#34;Model&#34;</span><span class="p">:</span> <span class="s2">&#34;Logistic model&#34;</span><span class="p">,</span>
                                    <span class="s2">&#34;Accuracy&#34;</span><span class="p">:</span> <span class="n">Accuracy</span><span class="p">,</span>
                                    <span class="s2">&#34;Precision&#34;</span><span class="p">:</span> <span class="n">Precision</span><span class="p">,</span>
                                    <span class="s2">&#34;Recall&#34;</span><span class="p">:</span> <span class="n">Recall</span><span class="p">,</span>
                                    <span class="s2">&#34;F1-Score&#34;</span><span class="p">:</span> <span class="n">F1</span><span class="p">,</span>
                                    <span class="s2">&#34;AUC-Score&#34;</span><span class="p">:</span> <span class="n">auc_score</span><span class="p">},</span> <span class="n">ignore_index</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

<span class="c1"># Output:</span>
<span class="n">Results</span><span class="p">:</span> 
<span class="o">+++++</span> <span class="n">Accuracy</span> <span class="n">Score</span> <span class="mf">0.639</span>
<span class="o">+++++</span> <span class="n">Precision</span> <span class="n">Score</span> <span class="mf">0.598</span>
<span class="o">+++++</span> <span class="n">Recall</span> <span class="n">Score</span> <span class="mf">0.570</span>
<span class="o">+++++</span> <span class="n">F1</span> <span class="n">Score</span> <span class="mf">0.584</span>


              <span class="n">precision</span>    <span class="n">recall</span>  <span class="n">f1</span><span class="o">-</span><span class="n">score</span>   <span class="n">support</span>

    <span class="n">No</span> <span class="n">churn</span>       <span class="mf">0.67</span>      <span class="mf">0.69</span>      <span class="mf">0.68</span>      <span class="mi">3354</span>
       <span class="n">Churn</span>       <span class="mf">0.60</span>      <span class="mf">0.57</span>      <span class="mf">0.58</span>      <span class="mi">2675</span>

    <span class="n">accuracy</span>                           <span class="mf">0.64</span>      <span class="mi">6029</span>
   <span class="n">macro</span> <span class="n">avg</span>       <span class="mf">0.63</span>      <span class="mf">0.63</span>      <span class="mf">0.63</span>      <span class="mi">6029</span>
<span class="n">weighted</span> <span class="n">avg</span>       <span class="mf">0.64</span>      <span class="mf">0.64</span>      <span class="mf">0.64</span>      <span class="mi">6029</span>

<span class="o">+++++</span> <span class="n">AUC</span> <span class="p">(</span><span class="n">Area</span> <span class="n">under</span> <span class="n">the</span> <span class="n">ROC</span> <span class="n">Curve</span><span class="p">)</span> <span class="p">:</span> <span class="mf">0.632</span>
</code></pre></td></tr></table>
</div>
</div><p><br>
As we can see, the accuracy is 0.64.</p>
<p><img src = "./images/evaluationLR.png" style="height: 70%; width:70%; display: block; margin-left: auto; margin-right: auto;" /></p>
<h4 id="432-decision-tree-model">4.3.2. Decision Tree Model</h4>
<p>Here the results for hyperparameter tunning:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="c1"># GridSearchCV for Decision Tree Model</span>

<span class="n">parameters</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;max_depth&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">11</span><span class="p">)]</span>
<span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;class_weight&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="bp">None</span><span class="p">,</span> <span class="s1">&#39;balanced&#39;</span><span class="p">]</span>
<span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;max_features&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">8</span><span class="p">)]</span>
<span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;min_samples_leaf&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">11</span><span class="p">)]</span>

<span class="c1">#</span>
<span class="n">GS_tree</span> <span class="o">=</span> <span class="n">GridSearchCV</span><span class="p">(</span><span class="n">DecisionTreeClassifier</span><span class="p">(</span><span class="n">random_state</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">),</span> <span class="n">parameters</span> <span class="p">,</span> <span class="n">scoring</span> <span class="o">=</span> <span class="s1">&#39;accuracy&#39;</span><span class="p">,</span> <span class="n">cv</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
<span class="n">GS_tree</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">x_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>

<span class="n">GridSearchResults</span><span class="p">(</span><span class="n">GS_tree</span><span class="p">)</span>

<span class="c1"># Output:</span>
<span class="n">Best</span> <span class="n">parameters</span><span class="p">:</span> 
 <span class="p">{</span><span class="s1">&#39;class_weight&#39;</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span> <span class="s1">&#39;max_depth&#39;</span><span class="p">:</span> <span class="mi">8</span><span class="p">,</span> <span class="s1">&#39;max_features&#39;</span><span class="p">:</span> <span class="mi">7</span><span class="p">,</span> <span class="s1">&#39;min_samples_leaf&#39;</span><span class="p">:</span> <span class="mi">5</span><span class="p">}</span>
<span class="n">Best</span> <span class="n">score</span><span class="p">:</span> 
 <span class="mf">0.66344</span> <span class="p">(</span><span class="o">+/-</span><span class="mf">0.00662</span><span class="p">)</span>
<span class="n">All</span> <span class="n">parameters</span><span class="p">:</span> 
<span class="p">{</span><span class="s1">&#39;ccp_alpha&#39;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
 <span class="s1">&#39;class_weight&#39;</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span>
 <span class="s1">&#39;criterion&#39;</span><span class="p">:</span> <span class="s1">&#39;gini&#39;</span><span class="p">,</span>
 <span class="s1">&#39;max_depth&#39;</span><span class="p">:</span> <span class="mi">8</span><span class="p">,</span>
 <span class="s1">&#39;max_features&#39;</span><span class="p">:</span> <span class="mi">7</span><span class="p">,</span>
 <span class="s1">&#39;max_leaf_nodes&#39;</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span>
 <span class="s1">&#39;min_impurity_decrease&#39;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
 <span class="s1">&#39;min_samples_leaf&#39;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
 <span class="s1">&#39;min_samples_split&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
 <span class="s1">&#39;min_weight_fraction_leaf&#39;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
 <span class="s1">&#39;random_state&#39;</span><span class="p">:</span> <span class="mi">1000</span><span class="p">,</span>
 <span class="s1">&#39;splitter&#39;</span><span class="p">:</span> <span class="s1">&#39;best&#39;</span><span class="p">}</span>
                                            <span class="n">params</span>	    <span class="n">mean_test_score</span>	<span class="n">std_test_score</span>	<span class="n">rank_test_score</span>
<span class="mi">554</span>	<span class="p">{</span><span class="s1">&#39;class_weight&#39;</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span> <span class="s1">&#39;max_depth&#39;</span><span class="p">:</span> <span class="mi">8</span><span class="p">,</span> <span class="s1">&#39;max_fe...	0.663444	0.006620	1</span>
<span class="mi">474</span>	<span class="p">{</span><span class="s1">&#39;class_weight&#39;</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span> <span class="s1">&#39;max_depth&#39;</span><span class="p">:</span> <span class="mi">7</span><span class="p">,</span> <span class="s1">&#39;max_fe...	0.663371	0.009664	2</span>
<span class="mi">482</span>	<span class="p">{</span><span class="s1">&#39;class_weight&#39;</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span> <span class="s1">&#39;max_depth&#39;</span><span class="p">:</span> <span class="mi">7</span><span class="p">,</span> <span class="s1">&#39;max_fe...	0.661808	0.006527	3</span>
<span class="mi">485</span>	<span class="p">{</span><span class="s1">&#39;class_weight&#39;</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span> <span class="s1">&#39;max_depth&#39;</span><span class="p">:</span> <span class="mi">7</span><span class="p">,</span> <span class="s1">&#39;max_fe...	0.661666	0.008073	4</span>
<span class="mi">487</span>	<span class="p">{</span><span class="s1">&#39;class_weight&#39;</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span> <span class="s1">&#39;max_depth&#39;</span><span class="p">:</span> <span class="mi">7</span><span class="p">,</span> <span class="s1">&#39;max_fe...	0.661594	0.008310	5</span>
<span class="mi">481</span>	<span class="p">{</span><span class="s1">&#39;class_weight&#39;</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span> <span class="s1">&#39;max_depth&#39;</span><span class="p">:</span> <span class="mi">7</span><span class="p">,</span> <span class="s1">&#39;max_fe...	0.660883	0.008289	6</span>
<span class="mi">483</span>	<span class="p">{</span><span class="s1">&#39;class_weight&#39;</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span> <span class="s1">&#39;max_depth&#39;</span><span class="p">:</span> <span class="mi">7</span><span class="p">,</span> <span class="s1">&#39;max_fe...	0.660670	0.007874	7</span>
<span class="mi">553</span>	<span class="p">{</span><span class="s1">&#39;class_weight&#39;</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span> <span class="s1">&#39;max_depth&#39;</span><span class="p">:</span> <span class="mi">8</span><span class="p">,</span> <span class="s1">&#39;max_fe...	0.660669	0.010791	8</span>
<span class="mi">473</span>	<span class="p">{</span><span class="s1">&#39;class_weight&#39;</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span> <span class="s1">&#39;max_depth&#39;</span><span class="p">:</span> <span class="mi">7</span><span class="p">,</span> <span class="s1">&#39;max_fe...	0.660385	0.008892	9</span>
<span class="mi">480</span>	<span class="p">{</span><span class="s1">&#39;class_weight&#39;</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span> <span class="s1">&#39;max_depth&#39;</span><span class="p">:</span> <span class="mi">7</span><span class="p">,</span> <span class="s1">&#39;max_fe...	0.660314	0.009318	10</span>
</code></pre></td></tr></table>
</div>
</div><p><br>
Here the result for modeling and evaluation:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="n">dt_model</span> <span class="o">=</span> <span class="n">DecisionTreeClassifier</span><span class="p">(</span><span class="n">max_depth</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span><span class="n">max_features</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span> <span class="n">min_samples_leaf</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">random_state</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">);</span>
<span class="n">dt_model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">x_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>

<span class="n">Accuracy</span><span class="p">,</span> <span class="n">Precision</span><span class="p">,</span> <span class="n">Recall</span><span class="p">,</span> <span class="n">F1</span><span class="p">,</span> <span class="n">auc_score</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">,</span> <span class="n">y_prob</span> <span class="o">=</span> <span class="n">evaluationMetricsGCV</span><span class="p">(</span><span class="n">x_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">,</span> <span class="n">dt_model</span><span class="p">)</span>
<span class="n">model_stats</span> <span class="o">=</span> <span class="n">model_stats</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&#34;Model&#34;</span><span class="p">:</span> <span class="s2">&#34;Decision Tree model&#34;</span><span class="p">,</span>
                                    <span class="s2">&#34;Accuracy&#34;</span><span class="p">:</span> <span class="n">Accuracy</span><span class="p">,</span>
                                    <span class="s2">&#34;Precision&#34;</span><span class="p">:</span> <span class="n">Precision</span><span class="p">,</span>
                                    <span class="s2">&#34;Recall&#34;</span><span class="p">:</span> <span class="n">Recall</span><span class="p">,</span>
                                    <span class="s2">&#34;F1-Score&#34;</span><span class="p">:</span> <span class="n">F1</span><span class="p">,</span>
                                    <span class="s2">&#34;AUC-Score&#34;</span><span class="p">:</span> <span class="n">auc_score</span><span class="p">},</span> <span class="n">ignore_index</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

<span class="c1"># Output:</span>
<span class="n">Results</span><span class="p">:</span> 
<span class="o">+++++</span> <span class="n">Accuracy</span> <span class="n">Score</span> <span class="mf">0.673</span>
<span class="o">+++++</span> <span class="n">Precision</span> <span class="n">Score</span> <span class="mf">0.647</span>
<span class="o">+++++</span> <span class="n">Recall</span> <span class="n">Score</span> <span class="mf">0.582</span>
<span class="o">+++++</span> <span class="n">F1</span> <span class="n">Score</span> <span class="mf">0.612</span>


              <span class="n">precision</span>    <span class="n">recall</span>  <span class="n">f1</span><span class="o">-</span><span class="n">score</span>   <span class="n">support</span>

    <span class="n">No</span> <span class="n">churn</span>       <span class="mf">0.69</span>      <span class="mf">0.75</span>      <span class="mf">0.72</span>      <span class="mi">3354</span>
       <span class="n">Churn</span>       <span class="mf">0.65</span>      <span class="mf">0.58</span>      <span class="mf">0.61</span>      <span class="mi">2675</span>

    <span class="n">accuracy</span>                           <span class="mf">0.67</span>      <span class="mi">6029</span>
   <span class="n">macro</span> <span class="n">avg</span>       <span class="mf">0.67</span>      <span class="mf">0.66</span>      <span class="mf">0.67</span>      <span class="mi">6029</span>
<span class="n">weighted</span> <span class="n">avg</span>       <span class="mf">0.67</span>      <span class="mf">0.67</span>      <span class="mf">0.67</span>      <span class="mi">6029</span>

<span class="o">+++++</span> <span class="n">AUC</span> <span class="p">(</span><span class="n">Area</span> <span class="n">under</span> <span class="n">the</span> <span class="n">ROC</span> <span class="n">Curve</span><span class="p">)</span> <span class="p">:</span> <span class="mf">0.664</span>
</code></pre></td></tr></table>
</div>
</div><p><br>
As we can see, the accuracy is 0.67.</p>
<p><img src = "./images/evaluationDT.png" style="height: 70%; width:70%; display: block; margin-left: auto; margin-right: auto;" /></p>
<h3 id="433-support-vector-machine-model">4.3.3. Support Vector Machine Model</h3>
<p>Here the results for hyperparameter tunning:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="n">parameters</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;C&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mf">10e-2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">100</span><span class="p">]</span>
<span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;kernel&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;linear&#39;</span><span class="p">,</span><span class="s1">&#39;poly&#39;</span><span class="p">,</span> <span class="s1">&#39;rbf&#39;</span><span class="p">]</span>
<span class="c1">#parameters[&#39;gamma&#39;] = np.arange(0.01, 0.4, 0.1)</span>


<span class="c1">#</span>
<span class="n">GS_SVM</span> <span class="o">=</span> <span class="n">GridSearchCV</span><span class="p">(</span><span class="n">SVC</span><span class="p">(</span><span class="n">random_state</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span> <span class="n">probability</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span> <span class="n">parameters</span> <span class="p">,</span> <span class="n">scoring</span> <span class="o">=</span> <span class="s1">&#39;accuracy&#39;</span><span class="p">,</span> <span class="n">cv</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
<span class="n">GS_SVM</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">x_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>

<span class="n">GridSearchResults</span><span class="p">(</span><span class="n">GS_SVM</span><span class="p">)</span>

<span class="c1"># Output:</span>
<span class="n">Best</span> <span class="n">parameters</span><span class="p">:</span> 
 <span class="p">{</span><span class="s1">&#39;C&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;kernel&#39;</span><span class="p">:</span> <span class="s1">&#39;rbf&#39;</span><span class="p">}</span>
<span class="n">Best</span> <span class="n">score</span><span class="p">:</span> 
 <span class="mf">0.64545</span> <span class="p">(</span><span class="o">+/-</span><span class="mf">0.01170</span><span class="p">)</span>
<span class="n">All</span> <span class="n">parameters</span><span class="p">:</span> 
<span class="p">{</span><span class="s1">&#39;C&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
 <span class="s1">&#39;break_ties&#39;</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span>
 <span class="s1">&#39;cache_size&#39;</span><span class="p">:</span> <span class="mi">200</span><span class="p">,</span>
 <span class="s1">&#39;class_weight&#39;</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span>
 <span class="s1">&#39;coef0&#39;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
 <span class="s1">&#39;decision_function_shape&#39;</span><span class="p">:</span> <span class="s1">&#39;ovr&#39;</span><span class="p">,</span>
 <span class="s1">&#39;degree&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
 <span class="s1">&#39;gamma&#39;</span><span class="p">:</span> <span class="s1">&#39;scale&#39;</span><span class="p">,</span>
 <span class="s1">&#39;kernel&#39;</span><span class="p">:</span> <span class="s1">&#39;rbf&#39;</span><span class="p">,</span>
 <span class="s1">&#39;max_iter&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
 <span class="s1">&#39;probability&#39;</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span>
 <span class="s1">&#39;random_state&#39;</span><span class="p">:</span> <span class="mi">1000</span><span class="p">,</span>
 <span class="s1">&#39;shrinking&#39;</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span>
 <span class="s1">&#39;tol&#39;</span><span class="p">:</span> <span class="mf">0.001</span><span class="p">,</span>
 <span class="s1">&#39;verbose&#39;</span><span class="p">:</span> <span class="bp">False</span><span class="p">}</span>
                        <span class="n">params</span>	    <span class="n">mean_test_score</span>	<span class="n">std_test_score</span>	<span class="n">rank_test_score</span>
<span class="mi">5</span>	<span class="p">{</span><span class="s1">&#39;C&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;kernel&#39;</span><span class="p">:</span> <span class="s1">&#39;rbf&#39;</span><span class="p">}</span>	<span class="mf">0.645455</span>	<span class="mf">0.011701</span>	<span class="mi">1</span>
<span class="mi">7</span>	<span class="p">{</span><span class="s1">&#39;C&#39;</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span> <span class="s1">&#39;kernel&#39;</span><span class="p">:</span> <span class="s1">&#39;poly&#39;</span><span class="p">}</span>	<span class="mf">0.644317</span>	<span class="mf">0.010408</span>	<span class="mi">2</span>
<span class="mi">8</span>	<span class="p">{</span><span class="s1">&#39;C&#39;</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span> <span class="s1">&#39;kernel&#39;</span><span class="p">:</span> <span class="s1">&#39;rbf&#39;</span><span class="p">}</span>	<span class="mf">0.643818</span>	<span class="mf">0.012859</span>	<span class="mi">3</span>
<span class="mi">4</span>	<span class="p">{</span><span class="s1">&#39;C&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;kernel&#39;</span><span class="p">:</span> <span class="s1">&#39;poly&#39;</span><span class="p">}</span>	<span class="mf">0.639838</span>	<span class="mf">0.010713</span>	<span class="mi">4</span>
<span class="mi">2</span>	<span class="p">{</span><span class="s1">&#39;C&#39;</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">,</span> <span class="s1">&#39;kernel&#39;</span><span class="p">:</span> <span class="s1">&#39;rbf&#39;</span><span class="p">}</span>	<span class="mf">0.637066</span>	<span class="mf">0.013727</span>	<span class="mi">5</span>
<span class="mi">1</span>	<span class="p">{</span><span class="s1">&#39;C&#39;</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">,</span> <span class="s1">&#39;kernel&#39;</span><span class="p">:</span> <span class="s1">&#39;poly&#39;</span><span class="p">}</span>	<span class="mf">0.632587</span>	<span class="mf">0.010276</span>	<span class="mi">6</span>
<span class="mi">0</span>	<span class="p">{</span><span class="s1">&#39;C&#39;</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">,</span> <span class="s1">&#39;kernel&#39;</span><span class="p">:</span> <span class="s1">&#39;linear&#39;</span><span class="p">}</span>	<span class="mf">0.612112</span>	<span class="mf">0.012761</span>	<span class="mi">7</span>
<span class="mi">6</span>	<span class="p">{</span><span class="s1">&#39;C&#39;</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span> <span class="s1">&#39;kernel&#39;</span><span class="p">:</span> <span class="s1">&#39;linear&#39;</span><span class="p">}</span>	<span class="mf">0.612041</span>	<span class="mf">0.013000</span>	<span class="mi">8</span>
<span class="mi">3</span>	<span class="p">{</span><span class="s1">&#39;C&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;kernel&#39;</span><span class="p">:</span> <span class="s1">&#39;linear&#39;</span><span class="p">}</span>	<span class="mf">0.611970</span>	<span class="mf">0.012831</span>	<span class="mi">9</span>
</code></pre></td></tr></table>
</div>
</div><p><br>
Here the result for modeling and evaluation:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="n">svm_model</span> <span class="o">=</span> <span class="n">SVC</span><span class="p">(</span><span class="n">C</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">gamma</span> <span class="o">=</span> <span class="mf">0.31</span><span class="p">,</span> <span class="n">kernel</span> <span class="o">=</span> <span class="s1">&#39;rbf&#39;</span><span class="p">,</span> <span class="n">random_state</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span> <span class="n">probability</span><span class="o">=</span><span class="bp">True</span><span class="p">);</span>
<span class="n">svm_model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">x_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>

<span class="n">Accuracy</span><span class="p">,</span> <span class="n">Precision</span><span class="p">,</span> <span class="n">Recall</span><span class="p">,</span> <span class="n">F1</span><span class="p">,</span> <span class="n">auc_score</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">,</span> <span class="n">y_prob</span> <span class="o">=</span> <span class="n">evaluationMetricsGCV</span><span class="p">(</span><span class="n">x_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">,</span> <span class="n">svm_model</span><span class="p">)</span>
<span class="n">model_stats</span> <span class="o">=</span> <span class="n">model_stats</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&#34;Model&#34;</span><span class="p">:</span> <span class="s2">&#34;SVM model&#34;</span><span class="p">,</span>
                                    <span class="s2">&#34;Accuracy&#34;</span><span class="p">:</span> <span class="n">Accuracy</span><span class="p">,</span>
                                    <span class="s2">&#34;Precision&#34;</span><span class="p">:</span> <span class="n">Precision</span><span class="p">,</span>
                                    <span class="s2">&#34;Recall&#34;</span><span class="p">:</span> <span class="n">Recall</span><span class="p">,</span>
                                    <span class="s2">&#34;F1-Score&#34;</span><span class="p">:</span> <span class="n">F1</span><span class="p">,</span>
                                    <span class="s2">&#34;AUC-Score&#34;</span><span class="p">:</span> <span class="n">auc_score</span><span class="p">},</span> <span class="n">ignore_index</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

<span class="c1"># Output:</span>
<span class="n">Results</span><span class="p">:</span> 
<span class="o">+++++</span> <span class="n">Accuracy</span> <span class="n">Score</span> <span class="mf">0.664</span>
<span class="o">+++++</span> <span class="n">Precision</span> <span class="n">Score</span> <span class="mf">0.631</span>
<span class="o">+++++</span> <span class="n">Recall</span> <span class="n">Score</span> <span class="mf">0.587</span>
<span class="o">+++++</span> <span class="n">F1</span> <span class="n">Score</span> <span class="mf">0.608</span>


              <span class="n">precision</span>    <span class="n">recall</span>  <span class="n">f1</span><span class="o">-</span><span class="n">score</span>   <span class="n">support</span>

    <span class="n">No</span> <span class="n">churn</span>       <span class="mf">0.69</span>      <span class="mf">0.73</span>      <span class="mf">0.71</span>      <span class="mi">3354</span>
       <span class="n">Churn</span>       <span class="mf">0.63</span>      <span class="mf">0.59</span>      <span class="mf">0.61</span>      <span class="mi">2675</span>

    <span class="n">accuracy</span>                           <span class="mf">0.66</span>      <span class="mi">6029</span>
   <span class="n">macro</span> <span class="n">avg</span>       <span class="mf">0.66</span>      <span class="mf">0.66</span>      <span class="mf">0.66</span>      <span class="mi">6029</span>
<span class="n">weighted</span> <span class="n">avg</span>       <span class="mf">0.66</span>      <span class="mf">0.66</span>      <span class="mf">0.66</span>      <span class="mi">6029</span>

<span class="o">+++++</span> <span class="n">AUC</span> <span class="p">(</span><span class="n">Area</span> <span class="n">under</span> <span class="n">the</span> <span class="n">ROC</span> <span class="n">Curve</span><span class="p">)</span> <span class="p">:</span> <span class="mf">0.656</span>
</code></pre></td></tr></table>
</div>
</div><p><br>
As we can see, the accuracy is 0.66.</p>
<p><img src = "./images/evaluationSVM.png" style="height: 70%; width:70%; display: block; margin-left: auto; margin-right: auto;" /></p>
<h3 id="435-random-forest-model">4.3.5. Random Forest Model</h3>
<p>Here the results for hyperparameter tunning:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="c1"># GridSearchCV</span>

<span class="n">parameters</span> <span class="o">=</span> <span class="p">{}</span>
<span class="c1">#parameters[&#39;max_features&#39;] = [&#39;auto&#39;, &#39;sqrt&#39;, &#39;log2&#39;, None]</span>
<span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;n_estimators&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">100</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">300</span><span class="p">,</span> <span class="mi">400</span><span class="p">,</span> <span class="mi">500</span><span class="p">,</span> <span class="mi">600</span><span class="p">,</span> <span class="mi">700</span><span class="p">,</span> <span class="mi">800</span><span class="p">,</span> <span class="mi">900</span><span class="p">,</span> <span class="mi">1100</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span> <span class="mi">1100</span><span class="p">,</span> <span class="mi">1200</span><span class="p">,</span> <span class="mi">1300</span><span class="p">]</span>
<span class="c1">#parameters[&#39;criterion&#39;] = [&#39;entropy&#39;, &#39;gini&#39;]</span>
<span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;max_depth&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="bp">None</span><span class="p">]</span>

<span class="c1">#</span>
<span class="n">GS_rf_0</span> <span class="o">=</span> <span class="n">GridSearchCV</span><span class="p">(</span><span class="n">RandomForestClassifier</span><span class="p">(),</span> <span class="n">parameters</span> <span class="p">,</span> <span class="n">scoring</span> <span class="o">=</span> <span class="s1">&#39;accuracy&#39;</span><span class="p">,</span> <span class="n">cv</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
<span class="n">GS_rf_0</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">x_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>

<span class="n">GridSearchResults</span><span class="p">(</span><span class="n">GS_rf_0</span><span class="p">)</span>

<span class="c1"># Output.</span>
<span class="n">Best</span> <span class="n">parameters</span><span class="p">:</span> 
 <span class="p">{</span><span class="s1">&#39;max_depth&#39;</span><span class="p">:</span> <span class="mi">9</span><span class="p">,</span> <span class="s1">&#39;n_estimators&#39;</span><span class="p">:</span> <span class="mi">200</span><span class="p">}</span>
<span class="n">Best</span> <span class="n">score</span><span class="p">:</span> 
 <span class="mf">0.66863</span> <span class="p">(</span><span class="o">+/-</span><span class="mf">0.00920</span><span class="p">)</span>
<span class="n">All</span> <span class="n">parameters</span><span class="p">:</span> 
<span class="p">{</span><span class="s1">&#39;bootstrap&#39;</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span>
 <span class="s1">&#39;ccp_alpha&#39;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
 <span class="s1">&#39;class_weight&#39;</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span>
 <span class="s1">&#39;criterion&#39;</span><span class="p">:</span> <span class="s1">&#39;gini&#39;</span><span class="p">,</span>
 <span class="s1">&#39;max_depth&#39;</span><span class="p">:</span> <span class="mi">9</span><span class="p">,</span>
 <span class="s1">&#39;max_features&#39;</span><span class="p">:</span> <span class="s1">&#39;auto&#39;</span><span class="p">,</span>
 <span class="s1">&#39;max_leaf_nodes&#39;</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span>
 <span class="s1">&#39;max_samples&#39;</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span>
 <span class="s1">&#39;min_impurity_decrease&#39;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
 <span class="s1">&#39;min_samples_leaf&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
 <span class="s1">&#39;min_samples_split&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
 <span class="s1">&#39;min_weight_fraction_leaf&#39;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
 <span class="s1">&#39;n_estimators&#39;</span><span class="p">:</span> <span class="mi">200</span><span class="p">,</span>
 <span class="s1">&#39;n_jobs&#39;</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span>
 <span class="s1">&#39;oob_score&#39;</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span>
 <span class="s1">&#39;random_state&#39;</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span>
 <span class="s1">&#39;verbose&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
 <span class="s1">&#39;warm_start&#39;</span><span class="p">:</span> <span class="bp">False</span><span class="p">}</span>
                                <span class="n">params</span>	    <span class="n">mean_test_score</span>	<span class="n">std_test_score</span>	<span class="n">rank_test_score</span>
<span class="mi">29</span>	<span class="p">{</span><span class="s1">&#39;max_depth&#39;</span><span class="p">:</span> <span class="mi">9</span><span class="p">,</span> <span class="s1">&#39;n_estimators&#39;</span><span class="p">:</span> <span class="mi">200</span><span class="p">}</span>	<span class="mf">0.668632</span>	<span class="mf">0.009199</span>	<span class="mi">1</span>
<span class="mi">8</span>	<span class="p">{</span><span class="s1">&#39;max_depth&#39;</span><span class="p">:</span> <span class="mi">7</span><span class="p">,</span> <span class="s1">&#39;n_estimators&#39;</span><span class="p">:</span> <span class="mi">900</span><span class="p">}</span>	<span class="mf">0.668418</span>	<span class="mf">0.009838</span>	<span class="mi">2</span>
<span class="mi">19</span>	<span class="p">{</span><span class="s1">&#39;max_depth&#39;</span><span class="p">:</span> <span class="mi">8</span><span class="p">,</span> <span class="s1">&#39;n_estimators&#39;</span><span class="p">:</span> <span class="mi">600</span><span class="p">}</span>	<span class="mf">0.668348</span>	<span class="mf">0.008300</span>	<span class="mi">3</span>
<span class="mi">10</span>	<span class="p">{</span><span class="s1">&#39;max_depth&#39;</span><span class="p">:</span> <span class="mi">7</span><span class="p">,</span> <span class="s1">&#39;n_estimators&#39;</span><span class="p">:</span> <span class="mi">1000</span><span class="p">}</span>	<span class="mf">0.668347</span>	<span class="mf">0.010234</span>	<span class="mi">4</span>
<span class="mi">49</span>	<span class="p">{</span><span class="s1">&#39;max_depth&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span> <span class="s1">&#39;n_estimators&#39;</span><span class="p">:</span> <span class="mi">800</span><span class="p">}</span>	<span class="mf">0.668064</span>	<span class="mf">0.008299</span>	<span class="mi">5</span>
<span class="mi">15</span>	<span class="p">{</span><span class="s1">&#39;max_depth&#39;</span><span class="p">:</span> <span class="mi">8</span><span class="p">,</span> <span class="s1">&#39;n_estimators&#39;</span><span class="p">:</span> <span class="mi">200</span><span class="p">}</span>	<span class="mf">0.667992</span>	<span class="mf">0.008415</span>	<span class="mi">6</span>
<span class="mi">23</span>	<span class="p">{</span><span class="s1">&#39;max_depth&#39;</span><span class="p">:</span> <span class="mi">8</span><span class="p">,</span> <span class="s1">&#39;n_estimators&#39;</span><span class="p">:</span> <span class="mi">1100</span><span class="p">}</span>	<span class="mf">0.667921</span>	<span class="mf">0.008200</span>	<span class="mi">7</span>
<span class="mi">38</span>	<span class="p">{</span><span class="s1">&#39;max_depth&#39;</span><span class="p">:</span> <span class="mi">9</span><span class="p">,</span> <span class="s1">&#39;n_estimators&#39;</span><span class="p">:</span> <span class="mi">1000</span><span class="p">}</span>	<span class="mf">0.667779</span>	<span class="mf">0.007937</span>	<span class="mi">8</span>
<span class="mi">6</span>	<span class="p">{</span><span class="s1">&#39;max_depth&#39;</span><span class="p">:</span> <span class="mi">7</span><span class="p">,</span> <span class="s1">&#39;n_estimators&#39;</span><span class="p">:</span> <span class="mi">700</span><span class="p">}</span>	<span class="mf">0.667779</span>	<span class="mf">0.010037</span>	<span class="mi">9</span>
<span class="mi">28</span>	<span class="p">{</span><span class="s1">&#39;max_depth&#39;</span><span class="p">:</span> <span class="mi">9</span><span class="p">,</span> <span class="s1">&#39;n_estimators&#39;</span><span class="p">:</span> <span class="mi">100</span><span class="p">}</span>	<span class="mf">0.667566</span>	<span class="mf">0.008903</span>	<span class="mi">10</span>
</code></pre></td></tr></table>
</div>
</div><p><br>
Here the result for modeling and evaluation:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="n">rf_model</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">criterion</span> <span class="o">=</span> <span class="s1">&#39;entropy&#39;</span><span class="p">,</span> <span class="n">max_depth</span> <span class="o">=</span><span class="mi">9</span><span class="p">,</span> <span class="n">n_estimators</span> <span class="o">=</span> <span class="mi">170</span><span class="p">,</span> <span class="n">max_features</span> <span class="o">=</span> <span class="bp">None</span><span class="p">)</span>
<span class="n">rf_model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">x_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>

<span class="n">Accuracy</span><span class="p">,</span> <span class="n">Precision</span><span class="p">,</span> <span class="n">Recall</span><span class="p">,</span> <span class="n">F1</span><span class="p">,</span> <span class="n">auc_score</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">,</span> <span class="n">y_prob</span> <span class="o">=</span> <span class="n">evaluationMetricsGCV</span><span class="p">(</span><span class="n">x_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">,</span> <span class="n">rf_model</span><span class="p">)</span>
<span class="n">model_stats</span> <span class="o">=</span> <span class="n">model_stats</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&#34;Model&#34;</span><span class="p">:</span> <span class="s2">&#34;Random Forest model&#34;</span><span class="p">,</span>
                                    <span class="s2">&#34;Accuracy&#34;</span><span class="p">:</span> <span class="n">Accuracy</span><span class="p">,</span>
                                    <span class="s2">&#34;Precision&#34;</span><span class="p">:</span> <span class="n">Precision</span><span class="p">,</span>
                                    <span class="s2">&#34;Recall&#34;</span><span class="p">:</span> <span class="n">Recall</span><span class="p">,</span>
                                    <span class="s2">&#34;F1-Score&#34;</span><span class="p">:</span> <span class="n">F1</span><span class="p">,</span>
                                    <span class="s2">&#34;AUC-Score&#34;</span><span class="p">:</span> <span class="n">auc_score</span><span class="p">},</span> <span class="n">ignore_index</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

<span class="c1"># Output:</span>
<span class="n">Results</span><span class="p">:</span> 
<span class="o">+++++</span> <span class="n">Accuracy</span> <span class="n">Score</span> <span class="mf">0.688</span>
<span class="o">+++++</span> <span class="n">Precision</span> <span class="n">Score</span> <span class="mf">0.663</span>
<span class="o">+++++</span> <span class="n">Recall</span> <span class="n">Score</span> <span class="mf">0.603</span>
<span class="o">+++++</span> <span class="n">F1</span> <span class="n">Score</span> <span class="mf">0.631</span>


              <span class="n">precision</span>    <span class="n">recall</span>  <span class="n">f1</span><span class="o">-</span><span class="n">score</span>   <span class="n">support</span>

    <span class="n">No</span> <span class="n">churn</span>       <span class="mf">0.70</span>      <span class="mf">0.76</span>      <span class="mf">0.73</span>      <span class="mi">3354</span>
       <span class="n">Churn</span>       <span class="mf">0.66</span>      <span class="mf">0.60</span>      <span class="mf">0.63</span>      <span class="mi">2675</span>

    <span class="n">accuracy</span>                           <span class="mf">0.69</span>      <span class="mi">6029</span>
   <span class="n">macro</span> <span class="n">avg</span>       <span class="mf">0.68</span>      <span class="mf">0.68</span>      <span class="mf">0.68</span>      <span class="mi">6029</span>
<span class="n">weighted</span> <span class="n">avg</span>       <span class="mf">0.69</span>      <span class="mf">0.69</span>      <span class="mf">0.69</span>      <span class="mi">6029</span>

<span class="o">+++++</span> <span class="n">AUC</span> <span class="p">(</span><span class="n">Area</span> <span class="n">under</span> <span class="n">the</span> <span class="n">ROC</span> <span class="n">Curve</span><span class="p">)</span> <span class="p">:</span> <span class="mf">0.679</span>

</code></pre></td></tr></table>
</div>
</div><p><br>
As we can see, the accuracy is 0.69.</p>
<p><img src = "./images/evaluationRF.png" style="height: 70%; width:70%; display: block; margin-left: auto; margin-right: auto;" /></p>
<h3 id="435-k-nearest-neighbors-model">4.3.5. K-Nearest Neighbors Model</h3>
<p>Here the results for hyperparameter tunning:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="c1"># GridSearchCV for KNN</span>

<span class="n">parameters</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;n_neighbors&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">50</span><span class="p">)]</span>
<span class="c1">#parameters[&#39;weights&#39;] = [&#39;uniform&#39;, &#39;distance&#39;]</span>
<span class="c1">#parameters[&#39;algorithm&#39;] = [&#39;auto&#39;, &#39;ball_tree&#39;, &#39;kd_tree&#39;, &#39;brute&#39;]</span>

<span class="c1">#</span>
<span class="n">GS_knn_0</span> <span class="o">=</span> <span class="n">GridSearchCV</span><span class="p">(</span><span class="n">KNeighborsClassifier</span><span class="p">(),</span> <span class="n">parameters</span> <span class="p">,</span> <span class="n">scoring</span> <span class="o">=</span> <span class="s1">&#39;accuracy&#39;</span><span class="p">,</span> <span class="n">cv</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
<span class="n">GS_knn_0</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">x_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>

<span class="n">GridSearchResults</span><span class="p">(</span><span class="n">GS_knn_0</span><span class="p">)</span>

<span class="c1"># Output:</span>
<span class="n">Best</span> <span class="n">parameters</span><span class="p">:</span> 
 <span class="p">{</span><span class="s1">&#39;n_neighbors&#39;</span><span class="p">:</span> <span class="mi">37</span><span class="p">}</span>
<span class="n">Best</span> <span class="n">score</span><span class="p">:</span> 
 <span class="mf">0.63380</span> <span class="p">(</span><span class="o">+/-</span><span class="mf">0.00678</span><span class="p">)</span>
<span class="n">All</span> <span class="n">parameters</span><span class="p">:</span> 
<span class="p">{</span><span class="s1">&#39;algorithm&#39;</span><span class="p">:</span> <span class="s1">&#39;auto&#39;</span><span class="p">,</span>
 <span class="s1">&#39;leaf_size&#39;</span><span class="p">:</span> <span class="mi">30</span><span class="p">,</span>
 <span class="s1">&#39;metric&#39;</span><span class="p">:</span> <span class="s1">&#39;minkowski&#39;</span><span class="p">,</span>
 <span class="s1">&#39;metric_params&#39;</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span>
 <span class="s1">&#39;n_jobs&#39;</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span>
 <span class="s1">&#39;n_neighbors&#39;</span><span class="p">:</span> <span class="mi">37</span><span class="p">,</span>
 <span class="s1">&#39;p&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
 <span class="s1">&#39;weights&#39;</span><span class="p">:</span> <span class="s1">&#39;uniform&#39;</span><span class="p">}</span>
                    <span class="n">params</span>	<span class="n">mean_test_score</span>	<span class="n">std_test_score</span>	<span class="n">rank_test_score</span>
<span class="mi">36</span>	<span class="p">{</span><span class="s1">&#39;n_neighbors&#39;</span><span class="p">:</span> <span class="mi">37</span><span class="p">}</span>	<span class="mf">0.633796</span>	<span class="mf">0.006776</span>	<span class="mi">1</span>
<span class="mi">37</span>	<span class="p">{</span><span class="s1">&#39;n_neighbors&#39;</span><span class="p">:</span> <span class="mi">38</span><span class="p">}</span>	<span class="mf">0.632374</span>	<span class="mf">0.009099</span>	<span class="mi">2</span>
<span class="mi">38</span>	<span class="p">{</span><span class="s1">&#39;n_neighbors&#39;</span><span class="p">:</span> <span class="mi">39</span><span class="p">}</span>	<span class="mf">0.631309</span>	<span class="mf">0.004983</span>	<span class="mi">3</span>
<span class="mi">35</span>	<span class="p">{</span><span class="s1">&#39;n_neighbors&#39;</span><span class="p">:</span> <span class="mi">36</span><span class="p">}</span>	<span class="mf">0.630597</span>	<span class="mf">0.007942</span>	<span class="mi">4</span>
<span class="mi">34</span>	<span class="p">{</span><span class="s1">&#39;n_neighbors&#39;</span><span class="p">:</span> <span class="mi">35</span><span class="p">}</span>	<span class="mf">0.630454</span>	<span class="mf">0.008985</span>	<span class="mi">5</span>
<span class="mi">32</span>	<span class="p">{</span><span class="s1">&#39;n_neighbors&#39;</span><span class="p">:</span> <span class="mi">33</span><span class="p">}</span>	<span class="mf">0.630241</span>	<span class="mf">0.008958</span>	<span class="mi">6</span>
<span class="mi">30</span>	<span class="p">{</span><span class="s1">&#39;n_neighbors&#39;</span><span class="p">:</span> <span class="mi">31</span><span class="p">}</span>	<span class="mf">0.629885</span>	<span class="mf">0.010527</span>	<span class="mi">7</span>
<span class="mi">22</span>	<span class="p">{</span><span class="s1">&#39;n_neighbors&#39;</span><span class="p">:</span> <span class="mi">23</span><span class="p">}</span>	<span class="mf">0.629033</span>	<span class="mf">0.010570</span>	<span class="mi">8</span>
<span class="mi">33</span>	<span class="p">{</span><span class="s1">&#39;n_neighbors&#39;</span><span class="p">:</span> <span class="mi">34</span><span class="p">}</span>	<span class="mf">0.629032</span>	<span class="mf">0.009545</span>	<span class="mi">9</span>
<span class="mi">31</span>	<span class="p">{</span><span class="s1">&#39;n_neighbors&#39;</span><span class="p">:</span> <span class="mi">32</span><span class="p">}</span>	<span class="mf">0.628677</span>	<span class="mf">0.009892</span>	<span class="mi">10</span>
</code></pre></td></tr></table>
</div>
</div><p><br>
Here the result for modeling and evaluation:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="n">knn_model</span> <span class="o">=</span> <span class="n">KNeighborsClassifier</span><span class="p">(</span><span class="n">algorithm</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span> <span class="n">n_neighbors</span> <span class="o">=</span> <span class="mi">37</span><span class="p">,</span> <span class="n">weights</span> <span class="o">=</span> <span class="s1">&#39;uniform&#39;</span><span class="p">)</span>
<span class="n">knn_model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">x_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>

<span class="n">Accuracy</span><span class="p">,</span> <span class="n">Precision</span><span class="p">,</span> <span class="n">Recall</span><span class="p">,</span> <span class="n">F1</span><span class="p">,</span> <span class="n">auc_score</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">,</span> <span class="n">y_prob</span> <span class="o">=</span> <span class="n">evaluationMetricsGCV</span><span class="p">(</span><span class="n">x_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">,</span> <span class="n">knn_model</span><span class="p">)</span>
<span class="n">model_stats</span> <span class="o">=</span> <span class="n">model_stats</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&#34;Model&#34;</span><span class="p">:</span> <span class="s2">&#34;KNN model&#34;</span><span class="p">,</span>
                                    <span class="s2">&#34;Accuracy&#34;</span><span class="p">:</span> <span class="n">Accuracy</span><span class="p">,</span>
                                    <span class="s2">&#34;Precision&#34;</span><span class="p">:</span> <span class="n">Precision</span><span class="p">,</span>
                                    <span class="s2">&#34;Recall&#34;</span><span class="p">:</span> <span class="n">Recall</span><span class="p">,</span>
                                    <span class="s2">&#34;F1-Score&#34;</span><span class="p">:</span> <span class="n">F1</span><span class="p">,</span>
                                    <span class="s2">&#34;AUC-Score&#34;</span><span class="p">:</span> <span class="n">auc_score</span><span class="p">},</span> <span class="n">ignore_index</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

<span class="c1"># Output:</span>
<span class="n">Results</span><span class="p">:</span> 
<span class="o">+++++</span> <span class="n">Accuracy</span> <span class="n">Score</span> <span class="mf">0.638</span>
<span class="o">+++++</span> <span class="n">Precision</span> <span class="n">Score</span> <span class="mf">0.606</span>
<span class="o">+++++</span> <span class="n">Recall</span> <span class="n">Score</span> <span class="mf">0.524</span>
<span class="o">+++++</span> <span class="n">F1</span> <span class="n">Score</span> <span class="mf">0.562</span>


              <span class="n">precision</span>    <span class="n">recall</span>  <span class="n">f1</span><span class="o">-</span><span class="n">score</span>   <span class="n">support</span>

    <span class="n">No</span> <span class="n">churn</span>       <span class="mf">0.66</span>      <span class="mf">0.73</span>      <span class="mf">0.69</span>      <span class="mi">3354</span>
       <span class="n">Churn</span>       <span class="mf">0.61</span>      <span class="mf">0.52</span>      <span class="mf">0.56</span>      <span class="mi">2675</span>

    <span class="n">accuracy</span>                           <span class="mf">0.64</span>      <span class="mi">6029</span>
   <span class="n">macro</span> <span class="n">avg</span>       <span class="mf">0.63</span>      <span class="mf">0.63</span>      <span class="mf">0.63</span>      <span class="mi">6029</span>
<span class="n">weighted</span> <span class="n">avg</span>       <span class="mf">0.63</span>      <span class="mf">0.64</span>      <span class="mf">0.63</span>      <span class="mi">6029</span>

<span class="o">+++++</span> <span class="n">AUC</span> <span class="p">(</span><span class="n">Area</span> <span class="n">under</span> <span class="n">the</span> <span class="n">ROC</span> <span class="n">Curve</span><span class="p">)</span> <span class="p">:</span> <span class="mf">0.626</span>
</code></pre></td></tr></table>
</div>
</div><p><br>
As we can see, the accuracy is 0.64.</p>
<p><img src = "./images/evaluationKNN.png" style="height: 70%; width:70%; display: block; margin-left: auto; margin-right: auto;" /></p>
<div style="text-align: right">
  <a href="#indice">⬆</a>
</div>
<hr>
<h3 id="436-summary-and-save-the-model">4.3.6. Summary and save the model</h3>
<p>Now we have all the statistics and results of all models. As we can  see the best model is Random Forest whicha has a better accuracy( <r> ** 0.69  aprox.** </r>) than others.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="n">model_stats</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>

<span class="c1"># Output:</span>
<span class="o">|</span>    <span class="o">|</span> <span class="n">Model</span>               <span class="o">|</span>   <span class="n">Accuracy</span> <span class="o">|</span>   <span class="n">Precision</span> <span class="o">|</span>   <span class="n">Recall</span> <span class="o">|</span>   <span class="n">F1</span><span class="o">-</span><span class="n">Score</span> <span class="o">|</span>   <span class="n">AUC</span><span class="o">-</span><span class="n">Score</span> <span class="o">|</span> 
<span class="o">|---</span><span class="p">:</span><span class="o">|</span><span class="p">:</span><span class="o">--------------------|-----------</span><span class="p">:</span><span class="o">|------------</span><span class="p">:</span><span class="o">|---------</span><span class="p">:</span><span class="o">|-----------</span><span class="p">:</span><span class="o">|------------</span><span class="p">:</span><span class="o">|</span>
<span class="o">|</span>  <span class="mi">0</span> <span class="o">|</span> <span class="n">Logistic</span> <span class="n">model</span>      <span class="o">|</span>   <span class="mf">0.639244</span> <span class="o">|</span>    <span class="mf">0.598039</span> <span class="o">|</span> <span class="mf">0.570093</span> <span class="o">|</span>   <span class="mf">0.583732</span> <span class="o">|</span>    <span class="mf">0.632244</span> <span class="o">|</span>
<span class="o">|</span>  <span class="mi">1</span> <span class="o">|</span> <span class="n">Decision</span> <span class="n">Tree</span> <span class="n">model</span> <span class="o">|</span>   <span class="mf">0.673412</span> <span class="o">|</span>    <span class="mf">0.646717</span> <span class="o">|</span> <span class="mf">0.581682</span> <span class="o">|</span>   <span class="mf">0.612478</span> <span class="o">|</span>    <span class="mf">0.664127</span> <span class="o">|</span>
<span class="o">|</span>  <span class="mi">2</span> <span class="o">|</span> <span class="n">SVM</span> <span class="n">model</span>           <span class="o">|</span>   <span class="mf">0.664123</span> <span class="o">|</span>    <span class="mf">0.630522</span> <span class="o">|</span> <span class="mf">0.586916</span> <span class="o">|</span>   <span class="mf">0.607938</span> <span class="o">|</span>    <span class="mf">0.656308</span> <span class="o">|</span>
<span class="o">|</span>  <span class="mi">3</span> <span class="o">|</span> <span class="n">Random</span> <span class="n">Forest</span> <span class="n">model</span> <span class="o">|</span>   <span class="mf">0.687842</span> <span class="o">|</span>    <span class="mf">0.663102</span> <span class="o">|</span> <span class="mf">0.602617</span> <span class="o">|</span>   <span class="mf">0.631414</span> <span class="o">|</span>    <span class="mf">0.679215</span> <span class="o">|</span>
<span class="o">|</span>  <span class="mi">4</span> <span class="o">|</span> <span class="n">KNN</span> <span class="n">model</span>           <span class="o">|</span>   <span class="mf">0.637917</span> <span class="o">|</span>    <span class="mf">0.606494</span> <span class="o">|</span> <span class="mf">0.523738</span> <span class="o">|</span>   <span class="mf">0.562086</span> <span class="o">|</span>    <span class="mf">0.626359</span> <span class="o">|</span>
<span class="o">|</span>  <span class="mi">5</span> <span class="o">|</span> <span class="n">KNN</span> <span class="n">model</span>           <span class="o">|</span>   <span class="mf">0.637917</span> <span class="o">|</span>    <span class="mf">0.606771</span> <span class="o">|</span> <span class="mf">0.522617</span> <span class="o">|</span>   <span class="mf">0.561559</span> <span class="o">|</span>    <span class="mf">0.626246</span> <span class="o">|</span>
<span class="o">|</span>  <span class="mi">6</span> <span class="o">|</span> <span class="n">KNN</span> <span class="n">model</span>           <span class="o">|</span>   <span class="mf">0.637751</span> <span class="o">|</span>    <span class="mf">0.6066</span>   <span class="o">|</span> <span class="mf">0.522243</span> <span class="o">|</span>   <span class="mf">0.56127</span>  <span class="o">|</span>    <span class="mf">0.626059</span> <span class="o">|</span>
<span class="o">|</span>  <span class="mi">7</span> <span class="o">|</span> <span class="n">KNN</span> <span class="n">model</span>           <span class="o">|</span>   <span class="mf">0.637917</span> <span class="o">|</span>    <span class="mf">0.606494</span> <span class="o">|</span> <span class="mf">0.523738</span> <span class="o">|</span>   <span class="mf">0.562086</span> <span class="o">|</span>    <span class="mf">0.626359</span> <span class="o">|</span>

</code></pre></td></tr></table>
</div>
</div><p>So in this way, our model is a Random Forest with the following hyperparameters:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="n">GridSearchResults</span><span class="p">(</span><span class="n">GS_rf_2</span><span class="p">)</span>

<span class="c1"># Output:</span>

<span class="n">All</span> <span class="n">parameters</span><span class="p">:</span> 
<span class="p">{</span><span class="s1">&#39;bootstrap&#39;</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span>
 <span class="s1">&#39;ccp_alpha&#39;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
 <span class="s1">&#39;class_weight&#39;</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span>
 <span class="s1">&#39;criterion&#39;</span><span class="p">:</span> <span class="s1">&#39;entropy&#39;</span><span class="p">,</span>
 <span class="s1">&#39;max_depth&#39;</span><span class="p">:</span> <span class="mi">9</span><span class="p">,</span>
 <span class="s1">&#39;max_features&#39;</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span>
 <span class="s1">&#39;max_leaf_nodes&#39;</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span>
 <span class="s1">&#39;max_samples&#39;</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span>
 <span class="s1">&#39;min_impurity_decrease&#39;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
 <span class="s1">&#39;min_samples_leaf&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
 <span class="s1">&#39;min_samples_split&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
 <span class="s1">&#39;min_weight_fraction_leaf&#39;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
 <span class="s1">&#39;n_estimators&#39;</span><span class="p">:</span> <span class="mi">170</span><span class="p">,</span>
 <span class="s1">&#39;n_jobs&#39;</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span>
 <span class="s1">&#39;oob_score&#39;</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span>
 <span class="s1">&#39;random_state&#39;</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span>
 <span class="s1">&#39;verbose&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
 <span class="s1">&#39;warm_start&#39;</span><span class="p">:</span> <span class="bp">False</span><span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>We saved the model with pickle option in order to use later in prediction using new dataset.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="c1"># Saving the model:</span>
<span class="n">filename</span> <span class="o">=</span> <span class="s1">&#39;modelChurn.pickle&#39;</span>
<span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">rf_model</span><span class="p">,</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span><span class="s1">&#39;wb&#39;</span><span class="p">))</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="5-prediction-a-idsection5a">5. Prediction <a id="section5"></a></h2>
<p>We will test the model with new dataset. At the begging, we split the data in two: one for train/test and two for prediction. So we will use this prediction data. Here the key task for this part:</p>
<div class="mermaid">
    
graph LR;
    A[New Dataset] --> |Preprocess Pipeline| B[Dataset ready <br> for Prediction]
    B -->|Load Model| C[Prediction]

</div>
<h3 id="51-dataset-preparation">5.1. Dataset Preparation</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="c1"># Load the new dataset for prediction</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;./Data/df_prediction.csv&#39;</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s2">&#34;Size of the dataset:  </span><span class="si">%d</span><span class="s2">&#34;</span> <span class="o">%</span> <span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="k">print</span><span class="p">(</span><span class="s2">&#34;Number of variables: </span><span class="si">%d</span><span class="s2">&#34;</span> <span class="o">%</span> <span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>

<span class="c1"># Output:</span>
<span class="n">Size</span> <span class="n">of</span> <span class="n">the</span> <span class="n">dataset</span><span class="p">:</span>  <span class="mi">5400</span>
<span class="n">Number</span> <span class="n">of</span> <span class="n">variables</span><span class="p">:</span> <span class="mi">30</span>

    	<span class="n">churn</span>	<span class="n">age</span>	<span class="n">housing</span>	<span class="n">credit_score</span>	<span class="n">deposits</span>	<span class="n">withdrawal</span>	<span class="n">purchases_partners</span>	<span class="n">purchases</span>	<span class="n">cc_taken</span>	<span class="n">cc_recommended</span>	<span class="o">...</span>	<span class="n">waiting_4_loan</span>	<span class="n">cancelled_loan</span>	<span class="n">received_loan</span>	<span class="n">rejected_loan</span>	<span class="n">zodiac_sign</span>	<span class="n">left_for_two_month_plus</span>	<span class="n">left_for_one_month</span>	<span class="n">rewards_earned</span>	<span class="n">reward_rate</span>	<span class="n">is_referred</span>
<span class="n">user</span>																					
<span class="mi">53131</span>	<span class="mi">0</span>	<span class="mf">37.0</span>	<span class="n">O</span>	<span class="mf">588.0</span>	<span class="mi">5</span>	<span class="mi">0</span>	<span class="mi">19</span>	<span class="mi">5</span>	<span class="mi">0</span>	<span class="mi">58</span>	<span class="o">...</span>	<span class="mi">0</span>	<span class="mi">0</span>	<span class="mi">0</span>	<span class="mi">0</span>	<span class="n">Gemini</span>	<span class="mi">0</span>	<span class="mi">0</span>	<span class="mf">11.0</span>	<span class="mf">0.92</span>	<span class="mi">1</span>
<span class="mi">23310</span>	<span class="mi">1</span>	<span class="mf">31.0</span>	<span class="n">na</span>	<span class="mf">546.0</span>	<span class="mi">0</span>	<span class="mi">0</span>	<span class="mi">67</span>	<span class="mi">0</span>	<span class="mi">0</span>	<span class="mi">144</span>	<span class="o">...</span>	<span class="mi">0</span>	<span class="mi">0</span>	<span class="mi">0</span>	<span class="mi">0</span>	<span class="n">Sagittarius</span>	<span class="mi">0</span>	<span class="mi">0</span>	<span class="mf">17.0</span>	<span class="mf">0.57</span>	<span class="mi">1</span>
<span class="mi">29996</span>	<span class="mi">0</span>	<span class="mf">51.0</span>	<span class="n">na</span>	<span class="mf">508.0</span>	<span class="mi">0</span>	<span class="mi">0</span>	<span class="mi">7</span>	<span class="mi">0</span>	<span class="mi">0</span>	<span class="mi">15</span>	<span class="o">...</span>	<span class="mi">0</span>	<span class="mi">0</span>	<span class="mi">0</span>	<span class="mi">0</span>	<span class="n">Aries</span>	<span class="mi">0</span>	<span class="mi">0</span>	<span class="mf">6.0</span>	<span class="mf">0.20</span>	<span class="mi">1</span>
<span class="mi">60425</span>	<span class="mi">0</span>	<span class="mf">25.0</span>	<span class="n">na</span>	<span class="n">NaN</span>	<span class="mi">0</span>	<span class="mi">0</span>	<span class="mi">0</span>	<span class="mi">0</span>	<span class="mi">0</span>	<span class="mi">0</span>	<span class="o">...</span>	<span class="mi">0</span>	<span class="mi">0</span>	<span class="mi">0</span>	<span class="mi">0</span>	<span class="n">Pisces</span>	<span class="mi">1</span>	<span class="mi">0</span>	<span class="n">NaN</span>	<span class="mf">0.00</span>	<span class="mi">0</span>
<span class="mi">22972</span>	<span class="mi">1</span>	<span class="mf">28.0</span>	<span class="n">na</span>	<span class="n">NaN</span>	<span class="mi">0</span>	<span class="mi">0</span>	<span class="mi">3</span>	<span class="mi">0</span>	<span class="mi">0</span>	<span class="mi">5</span>	<span class="o">...</span>	<span class="mi">0</span>	<span class="mi">0</span>	<span class="mi">0</span>	<span class="mi">0</span>	<span class="n">Scorpio</span>	<span class="mi">1</span>	<span class="mi">0</span>	<span class="mf">2.0</span>	<span class="mf">0.07</span>	<span class="mi">0</span>
<span class="mi">5</span> <span class="n">rows</span> <span class="err">×</span> <span class="mi">30</span> <span class="n">columns</span>
</code></pre></td></tr></table>
</div>
</div><p><br>
During preprocesing phase, we create a pipeline list &ldquo;pipeline_preprocess&rdquo; which has all the necessary functions for make the preprocesing tasks.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="k">print</span><span class="p">(</span><span class="s2">&#34;</span><span class="se">\n</span><span class="s2">Steps for pre-processing: &#34;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">step</span><span class="p">,</span> <span class="n">function</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">pipeline_preprocess</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&#34;</span><span class="se">\t</span><span class="s2"> {:d}: {:s}&#34;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">step</span><span class="p">,</span> <span class="n">function</span><span class="o">.</span><span class="vm">__name__</span><span class="p">))</span>

<span class="c1"># Output:</span>
<span class="n">Steps</span> <span class="k">for</span> <span class="n">pre</span><span class="o">-</span><span class="n">processing</span><span class="p">:</span> 
	 <span class="mi">0</span><span class="p">:</span> <span class="n">dropnull</span>
	 <span class="mi">1</span><span class="p">:</span> <span class="n">dropduplicated</span>
	 <span class="mi">2</span><span class="p">:</span> <span class="n">dropcolumns</span>
	 <span class="mi">3</span><span class="p">:</span> <span class="n">remove_outlier</span>
	 <span class="mi">4</span><span class="p">:</span> <span class="n">standardizeNum</span>
	 <span class="mi">5</span><span class="p">:</span> <span class="n">removedummy</span>

</code></pre></td></tr></table>
</div>
</div><p><br>
So now we define a function for do this process to the new dataset:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">preprocess_data_pipeline</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">pipeline_preprocess</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">step</span><span class="p">,</span> <span class="n">function</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">pipeline_preprocess</span><span class="p">):</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">function</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&#34;Size of the dataset:  </span><span class="si">%d</span><span class="s2">&#34;</span> <span class="o">%</span> <span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&#34;Number of variables: </span><span class="si">%d</span><span class="s2">&#34;</span> <span class="o">%</span> <span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">display</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">df</span>

<span class="n">df_new</span> <span class="o">=</span> <span class="n">preprocess_data_pipeline</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">pipeline_preprocess</span><span class="p">)</span>

<span class="c1"># Output:</span>
<span class="n">Removing</span> <span class="n">columns</span> <span class="n">credit_score</span> <span class="ow">and</span> <span class="n">rewards_earned</span> <span class="o">...</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">Drop</span> <span class="n">null</span> <span class="n">values</span> <span class="kn">from</span> <span class="nn">age</span> <span class="nn">column</span> <span class="nn">...</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="n">There</span> <span class="n">are</span> <span class="n">duplicated</span> <span class="n">indexes</span><span class="o">....</span><span class="n">So</span> <span class="n">removing</span> <span class="n">duplicated</span> <span class="n">indexes</span> <span class="o">...</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="n">Drop</span> <span class="n">app_web_user</span><span class="p">,</span> <span class="n">deposit</span><span class="p">,</span> <span class="n">ios_user</span><span class="p">,</span> <span class="n">cc_recommended</span><span class="p">,</span> <span class="n">cancelled_loan</span><span class="s1">&#39;, &#39;</span><span class="n">received_loan</span><span class="s1">&#39;, &#39;</span><span class="n">rejected_loan</span><span class="s1">&#39;, &#39;</span><span class="n">waiting_4_loan</span><span class="s1">&#39; columns ...(4)</span>
<span class="n">The</span> <span class="n">outliers</span> <span class="n">are</span> <span class="p">:</span> <span class="p">[</span><span class="s1">&#39;age&#39;</span><span class="p">,</span> <span class="s1">&#39;purchases_partners&#39;</span><span class="p">,</span> <span class="s1">&#39;cc_application_begin&#39;</span><span class="p">,</span> <span class="s1">&#39;reward_rate&#39;</span><span class="p">]</span>
<span class="n">Removing</span> <span class="n">outliers</span> <span class="o">...</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<span class="n">Standarizing</span> <span class="n">Numerical</span> <span class="n">variables</span> <span class="o">...</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>
<span class="n">Convert</span> <span class="n">categorical</span> <span class="n">values</span> <span class="n">into</span> <span class="n">numbers</span> <span class="o">...</span><span class="p">(</span><span class="mi">7</span><span class="p">)</span>
<span class="n">Remove</span> <span class="n">Categorical</span> <span class="n">Variables</span> <span class="n">housing_na</span><span class="p">,</span> <span class="n">zodiac_sign_na</span><span class="p">,</span> <span class="n">payment_type_na</span> <span class="o">...</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span>
<span class="n">Size</span> <span class="n">of</span> <span class="n">the</span> <span class="n">dataset</span><span class="p">:</span>  <span class="mi">5309</span>
<span class="n">Number</span> <span class="n">of</span> <span class="n">variables</span><span class="p">:</span> <span class="mi">29</span>

        <span class="n">churn</span>	<span class="n">age</span>	<span class="n">purchases_partners</span>	<span class="n">cc_application_begin</span>	<span class="n">app_downloaded</span>	<span class="n">web_user</span>	<span class="n">android_user</span>	<span class="n">left_for_two_month_plus</span>	<span class="n">left_for_one_month</span>	<span class="n">reward_rate</span>	<span class="o">...</span>	<span class="n">zodiac_sign_Cancer</span>	<span class="n">zodiac_sign_Capricorn</span>	<span class="n">zodiac_sign_Gemini</span>	<span class="n">zodiac_sign_Leo</span>	<span class="n">zodiac_sign_Libra</span>	<span class="n">zodiac_sign_Pisces</span>	<span class="n">zodiac_sign_Sagittarius</span>	<span class="n">zodiac_sign_Scorpio</span>	<span class="n">zodiac_sign_Taurus</span>	<span class="n">zodiac_sign_Virgo</span>
<span class="n">user</span>																					
<span class="mi">53131</span>	<span class="mi">0</span>	<span class="mf">0.669618</span>	<span class="o">-</span><span class="mf">0.036352</span>	<span class="mf">1.610414</span>	<span class="mi">1</span>	<span class="mi">1</span>	<span class="mi">1</span>	<span class="mi">0</span>	<span class="mi">0</span>	<span class="mf">0.026999</span>	<span class="o">...</span>	<span class="mi">0</span>	<span class="mi">0</span>	<span class="mi">1</span>	<span class="mi">0</span>	<span class="mi">0</span>	<span class="mi">0</span>	<span class="mi">0</span>	<span class="mi">0</span>	<span class="mi">0</span>	<span class="mi">0</span>
<span class="mi">23310</span>	<span class="mi">1</span>	<span class="o">-</span><span class="mf">0.037564</span>	<span class="mf">1.761699</span>	<span class="mf">1.302417</span>	<span class="mi">1</span>	<span class="mi">0</span>	<span class="mi">0</span>	<span class="mi">0</span>	<span class="mi">0</span>	<span class="o">-</span><span class="mf">0.440722</span>	<span class="o">...</span>	<span class="mi">0</span>	<span class="mi">0</span>	<span class="mi">0</span>	<span class="mi">0</span>	<span class="mi">0</span>	<span class="mi">0</span>	<span class="mi">1</span>	<span class="mi">0</span>	<span class="mi">0</span>	<span class="mi">0</span>
<span class="mi">29996</span>	<span class="mi">0</span>	<span class="mf">2.319710</span>	<span class="o">-</span><span class="mf">0.485864</span>	<span class="mf">0.840422</span>	<span class="mi">1</span>	<span class="mi">1</span>	<span class="mi">0</span>	<span class="mi">0</span>	<span class="mi">0</span>	<span class="o">-</span><span class="mf">0.935169</span>	<span class="o">...</span>	<span class="mi">0</span>	<span class="mi">0</span>	<span class="mi">0</span>	<span class="mi">0</span>	<span class="mi">0</span>	<span class="mi">0</span>	<span class="mi">0</span>	<span class="mi">0</span>	<span class="mi">0</span>	<span class="mi">0</span>
<span class="mi">60425</span>	<span class="mi">0</span>	<span class="o">-</span><span class="mf">0.744746</span>	<span class="o">-</span><span class="mf">0.748080</span>	<span class="o">-</span><span class="mf">0.853562</span>	<span class="mi">0</span>	<span class="mi">1</span>	<span class="mi">0</span>	<span class="mi">1</span>	<span class="mi">0</span>	<span class="o">-</span><span class="mf">1.202438</span>	<span class="o">...</span>	<span class="mi">0</span>	<span class="mi">0</span>	<span class="mi">0</span>	<span class="mi">0</span>	<span class="mi">0</span>	<span class="mi">1</span>	<span class="mi">0</span>	<span class="mi">0</span>	<span class="mi">0</span>	<span class="mi">0</span>
<span class="mi">22972</span>	<span class="mi">1</span>	<span class="o">-</span><span class="mf">0.391155</span>	<span class="o">-</span><span class="mf">0.635702</span>	<span class="o">-</span><span class="mf">0.853562</span>	<span class="mi">1</span>	<span class="mi">0</span>	<span class="mi">1</span>	<span class="mi">1</span>	<span class="mi">0</span>	<span class="o">-</span><span class="mf">1.108894</span>	<span class="o">...</span>	<span class="mi">0</span>	<span class="mi">0</span>	<span class="mi">0</span>	<span class="mi">0</span>	<span class="mi">0</span>	<span class="mi">0</span>	<span class="mi">0</span>	<span class="mi">1</span>	<span class="mi">0</span>	<span class="mi">0</span>
<span class="mi">1195</span>	<span class="mi">0</span>	<span class="mf">0.080300</span>	<span class="mf">2.286131</span>	<span class="mf">1.610414</span>	<span class="mi">1</span>	<span class="mi">1</span>	<span class="mi">1</span>	<span class="mi">0</span>	<span class="mi">0</span>	<span class="mf">1.563795</span>	<span class="o">...</span>	<span class="mi">0</span>	<span class="mi">0</span>	<span class="mi">0</span>	<span class="mi">0</span>	<span class="mi">0</span>	<span class="mi">0</span>	<span class="mi">0</span>	<span class="mi">0</span>	<span class="mi">0</span>	<span class="mi">0</span>
<span class="mi">41350</span>	<span class="mi">1</span>	<span class="o">-</span><span class="mf">0.626882</span>	<span class="o">-</span><span class="mf">0.748080</span>	<span class="o">-</span><span class="mf">0.853562</span>	<span class="mi">1</span>	<span class="mi">0</span>	<span class="mi">1</span>	<span class="mi">0</span>	<span class="mi">0</span>	<span class="o">-</span><span class="mf">1.202438</span>	<span class="o">...</span>	<span class="mi">0</span>	<span class="mi">0</span>	<span class="mi">0</span>	<span class="mi">0</span>	<span class="mi">0</span>	<span class="mi">0</span>	<span class="mi">0</span>	<span class="mi">0</span>	<span class="mi">0</span>	<span class="mi">1</span>
<span class="mi">29695</span>	<span class="mi">0</span>	<span class="o">-</span><span class="mf">0.273291</span>	<span class="o">-</span><span class="mf">0.748080</span>	<span class="o">-</span><span class="mf">0.853562</span>	<span class="mi">1</span>	<span class="mi">1</span>	<span class="mi">0</span>	<span class="mi">0</span>	<span class="mi">0</span>	<span class="o">-</span><span class="mf">1.202438</span>	<span class="o">...</span>	<span class="mi">1</span>	<span class="mi">0</span>	<span class="mi">0</span>	<span class="mi">0</span>	<span class="mi">0</span>	<span class="mi">0</span>	<span class="mi">0</span>	<span class="mi">0</span>	<span class="mi">0</span>	<span class="mi">0</span>
<span class="mi">15739</span>	<span class="mi">1</span>	<span class="o">-</span><span class="mf">0.980473</span>	<span class="o">-</span><span class="mf">0.748080</span>	<span class="mf">0.840422</span>	<span class="mi">1</span>	<span class="mi">0</span>	<span class="mi">1</span>	<span class="mi">0</span>	<span class="mi">0</span>	<span class="mf">1.376707</span>	<span class="o">...</span>	<span class="mi">0</span>	<span class="mi">0</span>	<span class="mi">0</span>	<span class="mi">0</span>	<span class="mi">0</span>	<span class="mi">0</span>	<span class="mi">0</span>	<span class="mi">0</span>	<span class="mi">0</span>	<span class="mi">0</span>
<span class="mi">51516</span>	<span class="mi">0</span>	<span class="o">-</span><span class="mf">0.980473</span>	<span class="mf">0.825214</span>	<span class="o">-</span><span class="mf">0.391566</span>	<span class="mi">1</span>	<span class="mi">0</span>	<span class="mi">1</span>	<span class="mi">0</span>	<span class="mi">0</span>	<span class="o">-</span><span class="mf">0.400631</span>	<span class="o">...</span>	<span class="mi">0</span>	<span class="mi">0</span>	<span class="mi">0</span>	<span class="mi">0</span>	<span class="mi">0</span>	<span class="mi">0</span>	<span class="mi">0</span>	<span class="mi">0</span>	<span class="mi">0</span>	<span class="mi">0</span>
<span class="mi">10</span> <span class="n">rows</span> <span class="err">×</span> <span class="mi">29</span> <span class="n">columns</span>

</code></pre></td></tr></table>
</div>
</div><p><br>
Now we are ready to split filterint the &ldquo;new_num_features&rdquo;:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="c1"># Using feature selection for dataset</span>

<span class="n">new_num_features</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;purchases_partners&#39;</span><span class="p">,</span> <span class="s1">&#39;reward_rate&#39;</span><span class="p">,</span> <span class="s1">&#39;cc_application_begin&#39;</span><span class="p">,</span> <span class="s1">&#39;app_downloaded&#39;</span><span class="p">,</span> <span class="s1">&#39;zodiac_sign_Virgo&#39;</span><span class="p">,</span> <span class="s1">&#39;zodiac_sign_Taurus&#39;</span><span class="p">,</span> <span class="s1">&#39;zodiac_sign_Scorpio&#39;</span><span class="p">,</span> <span class="s1">&#39;zodiac_sign_Aquarius&#39;</span><span class="p">,</span> <span class="s1">&#39;housing_O&#39;</span><span class="p">,</span> <span class="s1">&#39;age&#39;</span><span class="p">,</span> <span class="s1">&#39;zodiac_sign_Libra&#39;</span><span class="p">,</span> <span class="s1">&#39;zodiac_sign_Leo&#39;</span><span class="p">]</span>

<span class="n">X</span> <span class="o">=</span> <span class="n">df_new</span><span class="p">[</span><span class="n">new_num_features</span><span class="p">]</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">df_new</span><span class="p">[</span><span class="s1">&#39;churn&#39;</span><span class="p">]</span>
<span class="k">print</span><span class="p">(</span><span class="s2">&#34;X shape: {}&#34;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="s2">&#34;y shape: {}&#34;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">y</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>

<span class="c1"># Output:</span>
<span class="n">X</span> <span class="n">shape</span><span class="p">:</span> <span class="p">(</span><span class="mi">5309</span><span class="p">,</span> <span class="mi">12</span><span class="p">)</span>
<span class="n">y</span> <span class="n">shape</span><span class="p">:</span> <span class="p">(</span><span class="mi">5309</span><span class="p">,)</span>

</code></pre></td></tr></table>
</div>
</div><h3 id="52-make-predictons">5.2. Make Predictons</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="c1"># Load the model:</span>
<span class="n">filename</span> <span class="o">=</span> <span class="s1">&#39;modelChurn.pickle&#39;</span>
<span class="n">model_Loaded</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">))</span>
<span class="c1"># Make predictions</span>

<span class="n">prediction</span> <span class="o">=</span> <span class="n">model_Loaded</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>

<span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">prediction</span><span class="p">)):</span>
    <span class="k">if</span> <span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">i</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
        <span class="n">res</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">res</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
    <span class="c1">#print(i, &#39; &#39;, res)</span>
    
<span class="k">print</span><span class="p">(</span><span class="s2">&#34;</span><span class="si">% o</span><span class="s2">f succesful prediction: {}&#34;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">results</span><span class="p">)</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">results</span><span class="p">)))</span>

<span class="c1"># Output:</span>
<span class="o">%</span> <span class="n">of</span> <span class="n">succesful</span> <span class="n">prediction</span><span class="p">:</span> <span class="mf">0.6824260689395366</span>

</code></pre></td></tr></table>
</div>
</div><div style="text-align: right">
  <a href="#indice">⬆</a>
</div>
<hr>
<h2 id="6-conclusions-and-lessons-learned-a-idsection6a">6. Conclusions and Lessons learned <a id="section6"></a></h2>
<ol>
<li>As spected, the prediction with new data is aroung $0.7$ which reflects the accuracy model</li>
<li>As reviewed, the 4 most important feature are purchases_partners, reward_rate, cc_application_begin, app_downloaded. They seems logical becasue those features are related to customer behavior related to the app. The others like zodiac_sigh or housing have low importance.</li>
<li>During deployment, we faced some issues related to processing time in gridsearchCV. To speed up, we split the tunning hyperparameters in phases using gridsearchCV.</li>
<li>We tried to improve accuracy but most of the model output in the range of $[0.64-0.69]$. It seems that the model is not so good. In the other hand, we choosed 12 features. It could be betteer if we choose less features.</li>
<li>During exploration, we need to separate the analysis in categorical and numerical. And with numerical feature in binary and not binary.</li>
</ol>
<div style="text-align: right">
  <a href="#indice">⬆</a>
</div>
<hr>



    </main>
  </div>
  <footer>
    <div class="footer-wrapper">
      
      <p>Powered by <a href="https://gohugo.io/" target="_blank" rel="external">Hugo</a> | ©Jhon Vargas </p> 
      
    </div>
  </footer>
  <link href="https://fonts.googleapis.com/css?family=Montserrat:500,600|Raleway:400,400i,600" rel="stylesheet">

  <script type="text/javascript">
    document.querySelector('.mobile-header').addEventListener('click', function () {
      var om = document.querySelector(".overlay-menu");
      if (document.querySelector('.hamburger').classList.contains("cross")) {
        document.querySelector('.hamburger').classList.remove("cross");
        om.style.display = "none";
        om.style.width = "0%";
        om.style.height = "0%";
      }
      else {
        document.querySelector('.hamburger').classList.add("cross");
        om.style.width = "100%";
        om.style.height = "100vh";
        om.style.display = "block";
      }
    });
  </script>
</body>
</html>
